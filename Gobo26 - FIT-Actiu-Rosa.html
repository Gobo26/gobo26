<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FitActiva: Vitalitat 59+</title>
    
    <!-- Estils Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React i ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Ajustos cr√≠tics per a m√≤bil */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100dvh; /* Dynamic viewport height: s'ajusta a les barres del navegador */
            overflow: hidden; /* Evita el scroll del cos, nom√©s scroll dins l'app */
            -webkit-tap-highlight-color: transparent;
            font-family: 'Montserrat', sans-serif;
        }
        
        #root {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(-10%); animation-timing-function: cubic-bezier(0.8,0,1,1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0,0,0.2,1); }
        }
        .animate-bounce-gentle { animation: bounce 2s infinite; }
    </style>

    <style>
        html, body { background-color: #0a0e1a !important; color: #e2e8f0 !important; }
        body::before { content:''; position:fixed; inset:0; background-image:linear-gradient(rgba(59,130,246,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(59,130,246,0.03) 1px,transparent 1px); background-size:40px 40px; pointer-events:none; z-index:0; }
        #root { position: relative; z-index: 1; }
        .bg-white, .bg-gray-50, .bg-slate-50, .bg-slate-100 { background-color: #111827 !important; }
        .bg-gray-100, .bg-gray-200 { background-color: #1a2235 !important; }
        .bg-slate-800, .bg-gray-800, .bg-gray-900 { background: rgba(10,14,26,0.92) !important; backdrop-filter: blur(20px); border-bottom: 1px solid #1e2d45 !important; }
        .text-gray-900, .text-gray-800, .text-gray-700, .text-slate-800, .text-slate-700 { color: #e2e8f0 !important; }
        .text-gray-600, .text-gray-500, .text-slate-500, .text-slate-600 { color: #94a3b8 !important; }
        .border-gray-200, .border-gray-300, .border-slate-200 { border-color: #1e2d45 !important; }
        .shadow, .shadow-md, .shadow-lg, .shadow-xl { box-shadow: 0 4px 20px rgba(0,0,0,0.5) !important; }
        .rounded-xl, .rounded-lg, .rounded-2xl { border: 1px solid #1e2d45; }
        footer { background: rgba(10,14,26,0.9) !important; border-top: 1px solid #1e2d45 !important; color: #64748b !important; }
        input, select, textarea { background-color: #1a2235 !important; color: #e2e8f0 !important; border-color: #1e2d45 !important; }
        input::placeholder { color: #64748b !important; }
        table { background: #111827 !important; }
        th { background: #1a2235 !important; color: #94a3b8 !important; }
        td { border-color: #1e2d45 !important; color: #e2e8f0 !important; }
        tr:hover td { background: #1a2235 !important; }
    </style>
</head>
<!-- El body ara utilitza 100dvh i centra el contingut nom√©s si la pantalla √©s gran (sm) -->
<body class="bg-gray-100 text-slate-800 flex justify-center sm:items-center">
    
    <!-- Contenidor principal: Al m√≤bil ocupa el 100%, a l'escriptori t√© mida de tel√®fon -->
    <div id="root" class="w-full h-full sm:h-[90vh] sm:max-h-[900px] sm:max-w-md bg-white sm:rounded-xl sm:shadow-2xl relative overflow-hidden"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- GOBO26 ---
        const Gobo26Badge = () => (
            <a href="https://ja.cat/appgobo" target="_blank" rel="noopener noreferrer"
               className="opacity-30 hover:opacity-70 transition-opacity"
               title="Gobo26">
                <svg width="24" height="24" viewBox="0 0 100 100" fill="none">
                    <polygon points="50,2 93,26 93,74 50,98 7,74 7,26" fill="#1e293b" stroke="#94a3b8" strokeWidth="3"/>
                    <text x="50" y="40" textAnchor="middle" fill="white" fontSize="24" fontWeight="800" fontFamily="sans-serif">G</text>
                    <text x="50" y="66" textAnchor="middle" fill="#94a3b8" fontSize="22" fontWeight="700" fontFamily="sans-serif">26</text>
                </svg>
            </a>
        );


        // --- ICONES ---
        const Icon = ({ children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );
        const Play = (p) => <Icon {...p}><polygon points="5 3 19 12 5 21 5 3"/></Icon>;
        const Pause = (p) => <Icon {...p}><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></Icon>;
        const Home = (p) => <Icon {...p}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const BarChart = (p) => <Icon {...p}><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></Icon>;
        const Lightbulb = (p) => <Icon {...p}><line x1="9" y1="18" x2="15" y2="18"/><line x1="10" y1="22" x2="14" y2="22"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 16.5 8 4.5 4.5 0 0 0 12 3.5 4.5 4.5 0 0 0 7.5 8c0 1.57.78 3.01 2 3.99"/></Icon>;
        const ChevronRight = (p) => <Icon {...p}><polyline points="9 18 15 12 9 6"/></Icon>;
        const SkipForward = (p) => <Icon {...p}><polygon points="5 4 15 12 5 20 5 4"/><line x1="19" y1="5" x2="19" y2="19"/></Icon>;
        const Info = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></Icon>;
        const Target = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></Icon>; 
        const HelpCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></Icon>;
        const Trash2 = (p) => <Icon {...p}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></Icon>;
        const X = (p) => <Icon {...p}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></Icon>;
        
        // --- DADES ---
        const TIPS_DATA = [
            { title: "Escolta el teu cos", text: "Si sents un dolor agut, atura't. La mol√®stia muscular √©s normal, el dolor articular no." },
            { title: "Hidrataci√≥", text: "Beu un got d'aigua abans i despr√©s de la rutina, encara que no tinguis set." },
            { title: "Const√†ncia", text: "√âs millor fer 15 minuts cada dia que 1 hora un sol dia a la setmana." },
            { title: "Postura", text: "Mantingues l'esquena recta i el pit obert, especialment quan estiguis assegut." },
            { title: "Respiraci√≥", text: "No aguantis la respiraci√≥. Inspira quan baixes el pes, expira quan fas la for√ßa." },
            { title: "Cal√ßat", text: "Fes servir sabates tancades i c√≤modes que t'aguantin b√© el turmell, fins i tot a casa." }
        ];

        const BADGES_CONFIG = [
            { id: 'first_step', title: 'Primer Pas', icon: 'üëü', threshold: 1, type: 'count' },
            { id: 'constant', title: 'Constant', icon: 'üìÖ', threshold: 3, type: 'streak' },
            { id: 'dedicated', title: 'Dedicat', icon: 'üí™', threshold: 10, type: 'count' },
            { id: 'week_perfect', title: 'Setmana Perfecta', icon: 'üî•', threshold: 7, type: 'streak' },
            { id: 'warrior', title: 'Guerrer', icon: '‚ö°', threshold: 25, type: 'count' },
            { id: 'unstoppable', title: 'Imparable', icon: 'üöÄ', threshold: 14, type: 'streak' },
            { id: 'master', title: 'Mestre', icon: 'üëë', threshold: 50, type: 'count' },
            { id: 'legend', title: 'Llegenda', icon: 'üèÜ', threshold: 30, type: 'streak' },
            { id: 'centurion', title: 'Centenari', icon: 'üíØ', threshold: 100, type: 'count' }
        ];

        const EXERCISE_LIBRARY = {
          // A
          a_warmup_shoulder_circles: { title: 'Cercles d\'espatlles', type: 'warmup', duration: 30, description: "Assegut, esquena recta. Fes rotacions suaus amb les espatlles cap enrere.", goal: "Escalfar l'articulaci√≥ per evitar lesions.", infographicType: 'shoulder_circles' },
          a_warmup_arm_swings: { title: 'Balanceig de bra√ßos', type: 'warmup', duration: 30, description: "Mou els bra√ßos endavant i enrere r√≠tmicament, com si caminessis de pressa.", goal: "Activaci√≥ de la circulaci√≥ superior.", infographicType: 'arm_swings' },
          a_warmup_march: { title: 'Marxa assegut', type: 'warmup', duration: 30, description: "Aixeca els genolls alternadament mentre est√†s assegut.", goal: "Pujar pulsacions lleugerament.", infographicType: 'march_seated' },
          a_strength_bicep: { title: 'Curl de B√≠ceps', type: 'strength', duration: 120, description: "Amb mancuernes. Enganxa els colzes al cos. Puja les peses a les espatlles i baixa a poc a poc.", goal: "Enfortir bra√ßos per carregar pes.", infographicType: 'bicep_curl_seated' },
          a_strength_lateral: { title: 'Elevacions Laterals', type: 'strength', duration: 120, description: "Mancuernes. Aixeca els bra√ßos pels costats fins a l'al√ßada de l'espatlla (creu). No pugis m√©s.", goal: "Enfortir espatlles i coll.", infographicType: 'lateral_raise' },
          a_strength_front_push: { title: 'Emp√®nyer endavant', type: 'strength', duration: 120, description: "Mancuernes al pit. Empeny endavant horitzontalment i torna a recollir.", goal: "Treballar pit i bra√ßos.", infographicType: 'front_push' },
          a_strength_row: { title: 'Rem Assegut', type: 'strength', duration: 180, description: "Inclina't lleugerament endavant. Porta els colzes enrere fregant les costelles, notant l'esquena.", goal: "Millorar la postura de l'esquena.", infographicType: 'seated_row' },
          a_cardio_march_soft: { title: 'Caminar al lloc', type: 'cardio', duration: 60, description: "Marxa asseguda constant sense parar. Mou els bra√ßos.", goal: "Mantenir el cor actiu.", infographicType: 'march_seated' },
          a_cardio_arms_up: { title: 'Bra√ßos amunt i avall', type: 'cardio', duration: 60, description: "Sense pes. Puja un bra√ß i baixa l'altre alternadament.", goal: "Mobilitat i crema de calories.", infographicType: 'arms_up_down' },
          a_cardio_toe_taps: { title: 'Tocs de peus r√†pids', type: 'cardio', duration: 60, description: "Toca amb la punta del peu a terra, r√†pid: dreta, esquerra, dreta...", goal: "Agilitat de cames.", infographicType: 'toe_taps' },
          a_stretch_arms_fwd: { title: 'Estirar bra√ßos', type: 'stretch', duration: 30, description: "Entrella√ßa els dits i estira els bra√ßos endavant, corbant l'esquena.", goal: "Relaxar om√≤plats.", infographicType: 'stretch_fwd' },
          a_stretch_shoulders: { title: 'Relaxar espatlles', type: 'stretch', duration: 30, description: "Puja les espatlles a les orelles i deixa-les caure de cop.", goal: "Deixar anar tensi√≥ cervical.", infographicType: 'shoulder_shrugs' },
          a_stretch_neck: { title: 'Estirament de coll', type: 'stretch', duration: 30, description: "Inclina el cap suaument cap a una espatlla. Aguanta i canvia.", goal: "Relaxar cervicals.", infographicType: 'neck_gentle' },
          // B
          b_warmup_walk: { title: 'Caminar assegut', type: 'warmup', duration: 60, description: "Mou cames i bra√ßos amb ritme constant.", goal: "Escalfament general.", infographicType: 'march_seated' },
          b_warmup_ankles: { title: 'Cercles de turmells', type: 'warmup', duration: 30, description: "Aixeca un peu i fes cercles amples. Despr√©s l'altre.", goal: "Mobilitat per evitar caigudes.", infographicType: 'ankle_circles' },
          b_strength_leg_ext: { title: 'Estirar cama', type: 'strength', duration: 120, description: "Estira una cama fins que el genoll estigui recte. Aguanta 2 segons i baixa.", goal: "Enfortir qu√†driceps (genolls).", infographicType: 'leg_extension' },
          b_strength_open_legs: { title: 'Obrir cames', type: 'strength', duration: 120, description: "Peus junts. Obre els genolls cap enfora i tanca.", goal: "Enfortir malucs i glutis.", infographicType: 'hip_abduction' },
          b_strength_calves: { title: 'Aixecar talons', type: 'strength', duration: 120, description: "Posa't de puntetes assegut, fent for√ßa amb els bessons.", goal: "Millorar la circulaci√≥ de les cames.", infographicType: 'calf_raises' },
          b_strength_lean: { title: 'Inclinar tronc', type: 'strength', duration: 180, description: "Esquena recta. Inclina't endavant des de la cintura i torna a pujar.", goal: "Enfortir lumbars suaument.", infographicType: 'forward_lean' },
          b_cardio_march_fast: { title: 'Marxa r√†pida', type: 'cardio', duration: 60, description: "Augmenta el ritme de la marxa.", goal: "Cremar calories.", infographicType: 'march_seated' },
          b_cardio_open_arms: { title: 'Obrir i tancar', type: 'cardio', duration: 60, description: "Obre els bra√ßos en creu i tanca'ls davant.", goal: "Coordinaci√≥.", infographicType: 'lateral_raise' },
          b_cardio_knee_touch: { title: 'Tocar genoll', type: 'cardio', duration: 60, description: "M√† dreta toca genoll esquerre, i al rev√©s.", goal: "Treball abdominal.", infographicType: 'knee_touch' },
          b_stretch_leg: { title: 'Estirar cama', type: 'stretch', duration: 30, description: "Tal√≥ a terra, cama recta. Inclina't una mica endavant.", goal: "Estirar part posterior cama.", infographicType: 'leg_stretch_seated' },
          b_stretch_arms_up: { title: 'Tocar el sostre', type: 'stretch', duration: 30, description: "Estira els bra√ßos amunt com si volguessis tocar el sostre.", goal: "Descomprimir columna.", infographicType: 'arms_up_stretch' },
          b_stretch_back: { title: 'Esquena de gat', type: 'stretch', duration: 30, description: "Mira't el melic i corba l'esquena rodona.", goal: "Relaxar zona lumbar.", infographicType: 'back_round' },
          // C
          c_warmup_arm_circles: { title: 'Cercles de bra√ßos', type: 'warmup', duration: 30, description: "Cercles grans amb els bra√ßos sencers.", goal: "Mobilitat d'espatlla.", infographicType: 'arm_circles_big' },
          c_warmup_feet: { title: 'Peus actius', type: 'warmup', duration: 30, description: "Mou els peus (punta-tal√≥) r√†pidament.", goal: "Activar turmells.", infographicType: 'calf_raises' },
          c_warmup_sway: { title: 'Balanceig', type: 'warmup', duration: 30, description: "Mou el tronc de costat a costat suaument.", goal: "Mobilitat de cintura.", infographicType: 'torso_sway' },
          c_strength_press: { title: 'Premsa espatlles', type: 'strength', duration: 120, description: "Mancuernes a les espatlles. Puja-les cap al sostre i baixa.", goal: "For√ßa per agafar coses altes.", infographicType: 'shoulder_press_seated' },
          c_strength_coord: { title: 'Cama + Bra√ßos', type: 'strength', duration: 120, description: "Estira una cama i alhora empeny els bra√ßos endavant.", goal: "Coordinaci√≥ cos sencer.", infographicType: 'coord_push' },
          c_strength_row: { title: 'Rem amb pes', type: 'strength', duration: 120, description: "Colzes enrere amb for√ßa, pit obert.", goal: "Esquena forta.", infographicType: 'seated_row' },
          c_strength_thighs: { title: 'Apretar cuixes', type: 'strength', duration: 180, description: "Posa un coix√≠ entre els genolls i apreta fort cap endins.", goal: "Treballar cara interna cuixa.", infographicType: 'thigh_squeeze' },
          c_cardio_arms_fast: { title: 'Bra√ßos r√†pids', type: 'cardio', duration: 60, description: "Puja i baixa bra√ßos amb ritme viu.", goal: "Pulsacions.", infographicType: 'arms_up_down' },
          c_cardio_twist: { title: 'Caminar + Gir', type: 'cardio', duration: 60, description: "Marxa i gira el tronc lleugerament cap al genoll que puja.", goal: "Cintura i cor.", infographicType: 'march_twist' },
          c_cardio_heels: { title: 'Tocs de talons', type: 'cardio', duration: 60, description: "Toca amb el tal√≥ a terra endavant, alternant.", goal: "Agilitat.", infographicType: 'heel_taps' },
          c_stretch_neck: { title: 'Estirar coll', type: 'stretch', duration: 30, description: "Mou el cap a un costat i a l'altre suaument.", goal: "Relaxar coll.", infographicType: 'neck_gentle' },
          c_stretch_hug: { title: 'Abra√ßada', type: 'stretch', duration: 30, description: "Abra√ßa't fort a tu mateix.", goal: "Estirar esquena alta.", infographicType: 'self_hug' },
          c_stretch_breathe: { title: 'Respiracions', type: 'stretch', duration: 30, description: "Mans a la panxa, inspira profundament pel nas.", goal: "Calma final.", infographicType: 'breathe' }
        };

        const ROUTINES = [
          { id: 'A', name: 'Rutina A: Bra√ßos', focus: 'Activaci√≥ superior', exercises: ['a_warmup_shoulder_circles', 'a_warmup_arm_swings', 'a_warmup_march', 'a_strength_bicep', 'a_strength_lateral', 'a_strength_front_push', 'a_strength_row', 'a_cardio_march_soft', 'a_cardio_arms_up', 'a_cardio_toe_taps', 'a_stretch_arms_fwd', 'a_stretch_shoulders', 'a_stretch_neck'] },
          { id: 'B', name: 'Rutina B: Cames', focus: 'For√ßa inferior', exercises: ['b_warmup_walk', 'b_warmup_ankles', 'b_strength_leg_ext', 'b_strength_open_legs', 'b_strength_calves', 'b_strength_lean', 'b_cardio_march_fast', 'b_cardio_open_arms', 'b_cardio_knee_touch', 'b_stretch_leg', 'b_stretch_arms_up', 'b_stretch_back'] },
          { id: 'C', name: 'Rutina C: Cos Sencer', focus: 'Coordinaci√≥', exercises: ['c_warmup_arm_circles', 'c_warmup_feet', 'c_warmup_sway', 'c_strength_press', 'c_strength_coord', 'c_strength_row', 'c_strength_thighs', 'c_cardio_arms_fast', 'c_cardio_twist', 'c_cardio_heels', 'c_stretch_neck', 'c_stretch_hug', 'c_stretch_breathe'] }
        ];

        // --- IL¬∑LUSTRACIONS ---
        const Illustration = ({ type }) => {
          const cSkin = "#FCD5B5"; const cHair = "#E2E8F0"; const cShirt = "#86EFAC"; 
          const cPants = "#334155"; const cChair = "#94A3B8"; const cProp = "#475569"; 
          const Head = ({ x, y }) => (<g transform={`translate(${x},${y})`}><circle cx="12" cy="15" r="8" fill={cHair} /><circle cx="0" cy="0" r="14" fill={cSkin} /><path d="M-14 -2 Q0 -18 14 -2 Q14 -8 0 -16 Q-14 -8 -14 -2" fill={cHair} /><path d="M-5 2 Q0 6 5 2" fill="none" stroke="#B45309" strokeWidth="1.5" strokeLinecap="round"/></g>);
          const SeatedBase = ({ bodyTilt = 0 }) => (<g transform="translate(100, 140)"><polyline points="-20,0 -20,-45 20,-45 20,0" fill="none" stroke={cChair} strokeWidth="4" /><path d="M-8 -45 L-8 0 M8 -45 L8 0" fill="none" stroke={cPants} strokeWidth="12" strokeLinecap="round"/><line x1="0" y1="-45" x2={bodyTilt} y2="-95" stroke={cShirt} strokeWidth="24" strokeLinecap="round" /><Head x={bodyTilt} y={-110} /></g>);

          if (['shoulder_circles', 'arm_swings'].includes(type)) return <g><SeatedBase /><g transform="translate(100, 140)"><path d="M-25 -95 Q -35 -105 -25 -115" fill="none" stroke="#F59E0B" strokeWidth="3" /><path d="M25 -95 Q 35 -105 25 -115" fill="none" stroke="#F59E0B" strokeWidth="3" /><path d="M-15 -90 L-15 -50 M15 -90 L15 -50" fill="none" stroke={cSkin} strokeWidth="8" /></g></g>;
          if (type.includes('bicep')) return <g><SeatedBase /><g transform="translate(100, 140)"><path d="M-12 -90 L-15 -50" fill="none" stroke={cSkin} strokeWidth="8" /><line x1="-25" y1="-45" x2="-5" y2="-45" stroke={cProp} strokeWidth="6" /><polyline points="12,-90 15,-60 25,-85" fill="none" stroke={cSkin} strokeWidth="8" /><line x1="15" y1="-85" x2="35" y2="-85" stroke={cProp} strokeWidth="6" /></g></g>;
          if (type.includes('march') || type.includes('knee')) return <g transform="translate(100, 140)"><polyline points="-20,0 -20,-45 20,-45 20,0" fill="none" stroke={cChair} strokeWidth="4" /><path d="M-8 -45 L-20 -60 L-25 -30" fill="none" stroke={cPants} strokeWidth="12" /><path d="M8 -45 L8 0" fill="none" stroke={cPants} strokeWidth="12" /><line x1="0" y1="-45" x2="0" y2="-95" stroke={cShirt} strokeWidth="24" /><Head x={0} y={-110} /><path d="M-12 -90 L-15 -50 M12 -90 L15 -50" fill="none" stroke={cSkin} strokeWidth="8" /></g>;
          if (type.includes('press') || type.includes('arms_up')) return <g><SeatedBase /><g transform="translate(100, 140)"><path d="M-12 -90 L-30 -110 L-30 -140" fill="none" stroke={cSkin} strokeWidth="8" /><path d="M12 -90 L30 -110 L30 -140" fill="none" stroke={cSkin} strokeWidth="8" /><line x1="-40" y1="-140" x2="-20" y2="-140" stroke={cProp} strokeWidth="6" /><line x1="40" y1="-140" x2="20" y2="-140" stroke={cProp} strokeWidth="6" /></g></g>;
          if (type.includes('leg')) return <g transform="translate(100, 140)"><polyline points="-20,0 -20,-45 20,-45 20,0" fill="none" stroke={cChair} strokeWidth="4" /><path d="M-8 -45 L-8 0" fill="none" stroke={cPants} strokeWidth="12" /><path d="M8 -45 L40 -45" fill="none" stroke={cPants} strokeWidth="12" /><line x1="0" y1="-45" x2="0" y2="-95" stroke={cShirt} strokeWidth="24" /><Head x={0} y={-110} /><path d="M-12 -90 L-15 -50 M12 -90 L15 -50" fill="none" stroke={cSkin} strokeWidth="8" /></g>;
          return <SeatedBase />;
        };

        const IllustrationWrapper = ({ type }) => (
            <div className="mx-auto bg-indigo-50 rounded-xl border-4 border-white shadow-lg overflow-hidden relative w-48 h-40 flex items-center justify-center shrink-0">
                <svg width="200" height="160" viewBox="0 0 200 160">
                    <Illustration type={type} />
                </svg>
            </div>
        );

        // --- APP ---
        function HealthApp() {
            const [activeTab, setActiveTab] = useState('home');
            const [currentExerciseIndex, setCurrentExerciseIndex] = useState(0);
            const [timer, setTimer] = useState(0);
            const [isActive, setIsActive] = useState(false);
            const [isBreak, setIsBreak] = useState(false);
            const [showConfetti, setShowConfetti] = useState(false);
            const [showResetModal, setShowResetModal] = useState(false);
            const [showResetConfirm, setShowResetConfirm] = useState(false);
            const [showGuideModal, setShowGuideModal] = useState(false);

            const [stats, setStats] = useState(() => {
                const saved = localStorage.getItem('fitActivaStats');
                return saved ? JSON.parse(saved) : { xp: 285, level: 2, streaks: 0, workoutsCompleted: 4, lastWorkout: null, totalExercises: 40, totalMinutes: 60, bestStreak: 1 };
            });

            useEffect(() => { localStorage.setItem('fitActivaStats', JSON.stringify(stats)); }, [stats]);

            useEffect(() => {
                let interval = null;
                if (isActive && timer > 0) interval = setInterval(() => setTimer(t => t - 1), 1000);
                else if (timer === 0 && isActive) handleTimerComplete();
                return () => clearInterval(interval);
            }, [isActive, timer]);

            const getCurrentRoutine = () => ROUTINES[stats.workoutsCompleted % ROUTINES.length];

            const handleTimerComplete = () => {
                setIsActive(false);
                const routine = getCurrentRoutine();
                if (!isBreak) {
                    const newStats = {...stats, totalExercises: stats.totalExercises + 1, totalMinutes: stats.totalMinutes + Math.ceil(EXERCISE_LIBRARY[routine.exercises[currentExerciseIndex]].duration / 60) };
                    setStats(newStats);
                    if (currentExerciseIndex < routine.exercises.length - 1) {
                        setIsBreak(true);
                        setTimer(15); 
                    } else {
                        finishWorkout();
                    }
                } else {
                    setIsBreak(false);
                    const nextIndex = currentExerciseIndex + 1;
                    setCurrentExerciseIndex(nextIndex);
                    setTimer(EXERCISE_LIBRARY[routine.exercises[nextIndex]].duration);
                    setIsActive(true);
                }
            };

            const startWorkout = () => {
                setActiveTab('workout');
                setCurrentExerciseIndex(0);
                setIsBreak(false);
                const firstEx = EXERCISE_LIBRARY[getCurrentRoutine().exercises[0]];
                setTimer(firstEx.duration);
                setIsActive(true);
            };

            const finishWorkout = () => {
                const today = new Date().toDateString();
                const isConsecutive = stats.lastWorkout === new Date(Date.now() - 86400000).toDateString();
                let newStreaks = isConsecutive ? stats.streaks + 1 : 1;
                if (today === stats.lastWorkout) newStreaks = stats.streaks;
                setStats(prev => ({ ...prev, xp: prev.xp + 300, workoutsCompleted: prev.workoutsCompleted + 1, streaks: newStreaks, bestStreak: Math.max(prev.bestStreak, newStreaks), lastWorkout: today }));
                setActiveTab('summary');
                setShowConfetti(true);
                setTimeout(() => setShowConfetti(false), 5000);
            };

            const handleReset = () => {
                localStorage.removeItem('fitActivaStats');
                setStats({ xp: 0, level: 1, streaks: 0, workoutsCompleted: 0, lastWorkout: null, totalExercises: 0, totalMinutes: 0, bestStreak: 0 });
                setShowResetModal(false);
                setShowResetConfirm(false);
                setActiveTab('home');
            };

            // VISTES
            const renderHome = () => {
                const routine = getCurrentRoutine();
                return (
                    <div className="flex flex-col h-full bg-slate-50 overflow-y-auto pb-20">
                        <div className="bg-slate-800 p-4 shadow-sm flex items-center justify-between gap-2 sticky top-0 z-10">
                            <div className="flex items-center gap-2">
                                <span className="text-2xl">üí™</span>
                                <h1 className="text-2xl font-bold text-white">FitActiva</h1>
                            </div>
                            <div className="flex gap-2"><Gobo26Badge />
                                <button onClick={() => setShowGuideModal(true)} className="bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-full p-2 transition-colors">
                                    <HelpCircle size={20} />
                                </button>
                                <button onClick={() => setShowResetModal(true)} className="bg-slate-700 hover:bg-red-800 text-red-400 rounded-full p-2 transition-colors">
                                    <Trash2 size={20} />
                                </button>
                            </div>
                        </div>
                        <div className="p-4 grid grid-cols-3 gap-2">
                            <div className="bg-indigo-500 text-white rounded-lg p-2 text-center shadow"><div className="text-xs opacity-80">Nivell</div><div className="font-bold text-xl">{stats.level}</div></div>
                            <div className="bg-indigo-500 text-white rounded-lg p-2 text-center shadow"><div className="text-xs opacity-80">XP</div><div className="font-bold text-xl">{stats.xp}</div></div>
                            <div className="bg-indigo-500 text-white rounded-lg p-2 text-center shadow"><div className="text-xs opacity-80">Sessions</div><div className="font-bold text-xl">{stats.workoutsCompleted}</div></div>
                        </div>
                        <div className="mx-4 bg-white rounded-xl shadow-md p-6 text-center border-t-4 border-indigo-500 mb-6">
                            <div className="text-5xl font-bold text-indigo-600 mb-2">{stats.level}</div>
                            <div className="text-lg text-slate-600 font-medium mb-4">Entusiasta Actiu</div>
                            <div className="h-4 bg-gray-100 rounded-full overflow-hidden mb-2 relative"><div className="absolute top-0 left-0 h-full bg-green-500" style={{width: `${(stats.xp/500)*100}%`}}></div></div>
                            <div className="text-xs text-slate-400">{stats.xp} / 500 XP</div>
                        </div>
                        <div className="mx-4 bg-indigo-50 rounded-xl p-4 border border-indigo-100 flex items-center justify-between mb-6 shadow-sm">
                            <div><h3 className="font-bold text-indigo-800 text-lg">{routine.name}</h3><p className="text-sm text-indigo-600">{routine.focus} ‚Ä¢ 20 min</p></div>
                            <button onClick={startWorkout} className="bg-green-500 hover:bg-green-600 text-white rounded-full p-3 shadow-lg animate-bounce-gentle"><Play fill="currentColor" /></button>
                        </div>
                        <div className="mx-4 bg-white rounded-xl shadow-sm p-4 mb-4">
                            <h3 className="font-bold text-indigo-500 mb-3 flex items-center gap-2"><span className="bg-red-100 text-red-600 p-1 rounded text-xs">FEB</span> Calendari</h3>
                            <div className="grid grid-cols-7 gap-2 text-center text-xs text-slate-500">
                                <div>Dl</div><div>Dm</div><div>Dc</div><div>Dj</div><div>Dv</div><div>Ds</div><div>Dg</div>
                                {[...Array(28)].map((_, i) => (<div key={i} className={`p-2 rounded ${i+1 === new Date().getDate() ? 'bg-green-600 text-white font-bold' : 'bg-slate-50'}`}>{i+1}</div>))}
                            </div>
                        </div>

                        {/* MODAL GUIA */}
                        {showGuideModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={() => setShowGuideModal(false)}>
                                <div className="bg-white rounded-2xl max-w-md w-full p-6" onClick={e => e.stopPropagation()}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-2xl font-bold">Com utilitzar FitActiva</h2>
                                        <button onClick={() => setShowGuideModal(false)}><X size={24} /></button>
                                    </div>
                                    <div className="space-y-4 text-sm">
                                        <div className="flex gap-3">
                                            <div className="bg-indigo-100 text-indigo-600 rounded-full p-3 h-12 w-12 flex items-center justify-center shrink-0"><Play size={20} /></div>
                                            <div><strong>Comen√ßa a entrenar</strong><br/>Prem el bot√≥ verd de Play per comen√ßar la rutina del dia.</div>
                                        </div>
                                        <div className="flex gap-3">
                                            <div className="bg-green-100 text-green-600 rounded-full p-3 h-12 w-12 flex items-center justify-center shrink-0"><Target size={20} /></div>
                                            <div><strong>Segueix les instruccions</strong><br/>Cada exercici t√© una il¬∑lustraci√≥ i descripci√≥.</div>
                                        </div>
                                        <div className="flex gap-3">
                                            <div className="bg-yellow-100 text-yellow-600 rounded-full p-3 h-12 w-12 flex items-center justify-center shrink-0 text-2xl">üèÜ</div>
                                            <div><strong>Guanya XP i insignies</strong><br/>Cada sessi√≥ et dona 300 XP i desbloqueja insignies.</div>
                                        </div>
                                        <div className="bg-indigo-50 p-3 rounded-lg border-2 border-indigo-200">
                                            <strong className="text-indigo-800">Recorda:</strong>
                                            <ul className="text-xs mt-2 space-y-1">
                                                <li>‚Ä¢ Si sents dolor agut, atura't</li>
                                                <li>‚Ä¢ Beu aigua abans i despr√©s</li>
                                                <li>‚Ä¢ Pots pausar en qualsevol moment</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <button onClick={() => setShowGuideModal(false)} className="mt-6 w-full bg-indigo-600 text-white py-3 rounded-xl font-bold">Entesos! üí™</button>
                                </div>
                            </div>
                        )}

                        {/* MODAL RESET */}
                        {showResetModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={() => {setShowResetModal(false); setShowResetConfirm(false);}}>
                                <div className="bg-white rounded-2xl max-w-md w-full p-6" onClick={e => e.stopPropagation()}>
                                    {!showResetConfirm ? (
                                        <>
                                            <div className="text-6xl text-center mb-4">‚ö†Ô∏è</div>
                                            <h2 className="text-2xl font-bold text-center mb-4">Atenci√≥!</h2>
                                            <p className="text-center mb-6">Est√†s a punt d'esborrar tot el teu progr√©s:</p>
                                            <div className="bg-red-50 border-2 border-red-200 rounded-xl p-4 mb-6 text-sm">
                                                <ul className="space-y-1">
                                                    <li>‚úó Nivell {stats.level} ({stats.xp} XP)</li>
                                                    <li>‚úó {stats.workoutsCompleted} sessions</li>
                                                    <li>‚úó Ratxa de {stats.streaks} dies</li>
                                                    <li>‚úó {stats.totalMinutes} minuts</li>
                                                </ul>
                                            </div>
                                            <p className="text-center font-bold mb-6">Aquesta acci√≥ no es pot desfer!</p>
                                            <div className="flex gap-3">
                                                <button onClick={() => setShowResetModal(false)} className="flex-1 bg-slate-200 py-3 rounded-xl font-bold">Cancel¬∑lar</button>
                                                <button onClick={() => setShowResetConfirm(true)} className="flex-1 bg-red-500 text-white py-3 rounded-xl font-bold">Continuar</button>
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                            <div className="text-6xl text-center mb-4">üî¥</div>
                                            <h2 className="text-xl font-bold text-center mb-4 text-red-600">Confirmaci√≥ Final</h2>
                                            <p className="text-center mb-6">Segur que vols esborrar tot el progr√©s?</p>
                                            <div className="flex gap-3">
                                                <button onClick={() => setShowResetConfirm(false)} className="flex-1 bg-green-500 text-white py-3 rounded-xl font-bold">No</button>
                                                <button onClick={handleReset} className="flex-1 bg-red-600 text-white py-3 rounded-xl font-bold">S√≠, esborrar</button>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            const renderProgress = () => (
                <div className="flex flex-col h-full bg-slate-50 overflow-y-auto pb-20">
                    <div className="bg-white p-4 shadow-sm mb-4 sticky top-0 z-10"><h1 className="text-2xl font-bold text-indigo-500">Assoliments</h1></div>
                    <div className="px-4 grid grid-cols-3 gap-3 mb-6">
                        {BADGES_CONFIG.map(badge => {
                            let achieved = (badge.type === 'count' && stats.workoutsCompleted >= badge.threshold) || (badge.type === 'streak' && stats.bestStreak >= badge.threshold);
                            return (
                                <div key={badge.id} className={`flex flex-col items-center justify-center p-3 rounded-xl text-center aspect-square ${achieved ? 'bg-gradient-to-br from-slate-700 to-slate-800 text-white shadow-lg' : 'bg-white text-slate-300 opacity-60'}`}>
                                    <div className="text-3xl mb-1">{badge.icon}</div>
                                    <div className="text-[10px] font-bold uppercase leading-tight">{badge.title}</div>
                                    <div className="text-[9px] mt-1 opacity-70">{achieved ? 'CONSEGUIT' : `${badge.type === 'streak' ? stats.bestStreak : stats.workoutsCompleted}/${badge.threshold}`}</div>
                                </div>
                            )
                        })}
                    </div>
                    <div className="mx-4 bg-white rounded-xl shadow-sm p-4 border-l-4 border-indigo-500">
                        <h3 className="font-bold text-indigo-500 mb-4 flex items-center gap-2"><BarChart size={18} /> Estad√≠stiques</h3>
                        <div className="space-y-4">
                            <div className="flex justify-between items-center border-b border-slate-100 pb-2"><span className="text-slate-600 text-sm">Exercicis:</span><span className="text-indigo-600 font-bold">{stats.totalExercises}</span></div>
                            <div className="flex justify-between items-center border-b border-slate-100 pb-2"><span className="text-slate-600 text-sm">Temps total:</span><span className="text-indigo-600 font-bold">{stats.totalMinutes} min</span></div>
                            <div className="flex justify-between items-center bg-indigo-50 p-2 rounded"><span className="text-slate-600 text-sm">Millor ratxa:</span><span className="text-red-500 font-bold">{stats.bestStreak} dies üî•</span></div>
                        </div>
                    </div>
                </div>
            );

            const renderTips = () => (
                <div className="flex flex-col h-full bg-slate-50 overflow-y-auto pb-20">
                    <div className="bg-white p-4 shadow-sm mb-4 sticky top-0 z-10"><h1 className="text-2xl font-bold text-indigo-500">Consells</h1></div>
                    <div className="px-4 space-y-4">
                        {TIPS_DATA.map((tip, i) => (<div key={i} className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-yellow-400"><h3 className="font-bold text-slate-800 mb-1">{tip.title}</h3><p className="text-sm text-slate-600">{tip.text}</p></div>))}
                    </div>
                </div>
            );

            const renderWorkout = () => {
                const routine = getCurrentRoutine();
                const ex = EXERCISE_LIBRARY[routine.exercises[currentExerciseIndex]];
                if (isBreak) {
                    const nextEx = EXERCISE_LIBRARY[routine.exercises[currentExerciseIndex + 1]];
                    return (
                        <div className="h-full flex flex-col items-center justify-center bg-indigo-600 text-white p-6 text-center">
                            <h2 className="text-3xl font-bold mb-4">Descans</h2>
                            <div className="text-7xl font-mono font-bold mb-8">{timer}s</div>
                            <p className="text-indigo-200 mb-8">Respira profundament</p>
                            {nextEx && <div className="bg-white/10 p-4 rounded-xl backdrop-blur w-full"><p className="text-xs uppercase text-indigo-300">A continuaci√≥</p><div className="font-bold text-xl">{nextEx.title}</div></div>}
                            <button onClick={handleTimerComplete} className="mt-8 bg-white text-indigo-600 px-6 py-2 rounded-full font-bold">Saltar</button>
                        </div>
                    );
                }
                return (
                    <div className="h-full flex flex-col bg-white">
                        <div className="p-4 flex justify-between items-center border-b">
                            <div className="text-sm text-slate-500 font-bold">EXERCICI {currentExerciseIndex + 1} / {routine.exercises.length}</div>
                            <button onClick={() => setActiveTab('home')} className="text-red-500 text-sm font-bold">SORTIR</button>
                        </div>
                        <div className="flex-1 flex flex-col p-4 overflow-y-auto">
                            <h2 className="text-2xl font-bold text-slate-800 mb-2">{ex.title}</h2>
                            <div className="flex gap-2 mb-4">
                                <span className={`text-xs px-2 py-1 rounded font-bold uppercase ${ex.type === 'strength' ? 'bg-green-100 text-green-700' : ex.type === 'cardio' ? 'bg-red-100 text-red-700' : 'bg-orange-100 text-orange-700'}`}>{ex.type === 'strength' ? 'For√ßa' : ex.type === 'cardio' ? 'Cardio' : 'Escalfament'}</span>
                                {ex.type === 'strength' && <span className="text-xs px-2 py-1 rounded bg-slate-100 text-slate-500 font-bold">MANCUERNES</span>}
                            </div>
                            <IllustrationWrapper type={ex.infographicType} />
                            <div className="text-center my-4"><div className={`text-6xl font-mono font-bold ${isActive ? 'text-indigo-600' : 'text-slate-300'}`}>{Math.floor(timer / 60)}:{String(timer % 60).padStart(2, '0')}</div></div>
                            <div className="bg-indigo-50 p-4 rounded-xl border border-indigo-100 space-y-3">
                                <div><div className="flex items-center gap-2 text-indigo-700 font-bold text-sm mb-1"><Info size={16} /> COM FER-HO</div><p className="text-slate-700 text-sm leading-relaxed">{ex.description}</p></div>
                                <div className="border-t border-indigo-100 pt-2"><div className="flex items-center gap-2 text-green-600 font-bold text-sm mb-1"><Target size={16} /> OBJECTIU</div><p className="text-slate-600 text-xs">{ex.goal}</p></div>
                            </div>
                        </div>
                        <div className="p-4 border-t bg-slate-50 grid grid-cols-4 gap-2">
                            <button onClick={() => { setIsActive(false); handleTimerComplete(); }} className="col-span-1 bg-white border border-slate-300 rounded-xl flex flex-col items-center justify-center text-slate-500 shadow-sm active:scale-95 transition-all"><SkipForward size={24} /><span className="text-[10px] font-bold">Saltar</span></button>
                            <button onClick={() => setIsActive(!isActive)} className={`col-span-3 rounded-xl text-white font-bold text-lg flex items-center justify-center gap-2 shadow-lg ${isActive ? 'bg-amber-500' : 'bg-green-500'}`}>{isActive ? <><Pause fill="currentColor" /> PAUSA</> : <><Play fill="currentColor" /> CONTINUAR</>}</button>
                        </div>
                    </div>
                );
            };

            const renderSummary = () => (
                <div className="h-full flex flex-col items-center justify-center bg-indigo-600 text-white p-8 text-center">
                    {showConfetti && <div className="absolute inset-0 pointer-events-none text-4xl animate-bounce-gentle">üéâ ‚ú® üëè</div>}
                    <div className="bg-white text-indigo-600 p-4 rounded-full mb-4 shadow-xl"><Icon><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 1 0 5H18"/><path d="M4 22h16"/><path d="M10 14.66V17"/><path d="M14 14.66V17"/><path d="M18 2h-4a4 4 0 0 0-8 0H2a2 2 0 0 0 2 2v6a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0 2-2Z"/></Icon></div>
                    <h2 className="text-3xl font-bold mb-2">Fant√†stic!</h2>
                    <p className="text-indigo-200 mb-8">Has completat la rutina d'avui.</p>
                    <button onClick={() => setActiveTab('home')} className="bg-white text-indigo-600 px-8 py-3 rounded-full font-bold shadow-lg">Tornar a l'Inici</button>
                </div>
            );

            const BottomNav = () => (
                <div className="absolute bottom-0 left-0 w-full bg-white border-t border-slate-200 flex justify-around py-2 pb-6 z-50 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
                    <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center ${activeTab === 'home' ? 'text-indigo-600' : 'text-slate-400'}`}><Home size={24} /><span className="text-[10px] font-bold mt-1">Inici</span></button>
                    <button onClick={() => setActiveTab('progress')} className={`flex flex-col items-center ${activeTab === 'progress' ? 'text-indigo-600' : 'text-slate-400'}`}><BarChart size={24} /><span className="text-[10px] font-bold mt-1">Progr√©s</span></button>
                    <button onClick={() => setActiveTab('tips')} className={`flex flex-col items-center ${activeTab === 'tips' ? 'text-indigo-600' : 'text-slate-400'}`}><Lightbulb size={24} /><span className="text-[10px] font-bold mt-1">Consells</span></button>
                </div>
            );

            return (
                <div className="h-full relative font-sans text-slate-800 bg-slate-50 flex flex-col">
                    <div className="flex-1 overflow-hidden relative">
                        {activeTab === 'home' && renderHome()}
                        {activeTab === 'progress' && renderProgress()}
                        {activeTab === 'tips' && renderTips()}
                        {activeTab === 'workout' && renderWorkout()}
                        {activeTab === 'summary' && renderSummary()}
                    </div>
                    {['home', 'progress', 'tips'].includes(activeTab) && <BottomNav />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HealthApp />);
    </script>
</body>
</html>
