<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gobo26 - Cascada Numèrica</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .animate-shake {
            animation: shake 0.3s ease-in-out;
        }
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    
/* HEADER */
header{width:100%;background:#1e293b;border-bottom:1px solid #334155;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
.logo{display:flex;align-items:center;gap:8px;text-decoration:none;}
.logo-txt{font-size:1rem;font-weight:900;color:white;letter-spacing:-0.5px;}
.logo-txt span{color:#3b82f6;}
.hdr-title{font-size:.95rem;font-weight:700;color:white;letter-spacing:.5px;}
</style>

    <style>
        html, body { background-color: #f1f5f9 !important; color: #334155 !important; }
    </style>
</head>
<header>
    <a href="https://ja.cat/appgobo" class="logo">
        <svg width="38" height="38" viewBox="0 0 40 40" fill="none">
            <polygon points="20,2 36,11 36,29 20,38 4,29 4,11" fill="#1e293b" stroke="#3b82f6" stroke-width="2"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="white" font-family="Montserrat,sans-serif" font-size="8" font-weight="900">GOBO</text>
            <text x="50%" y="72%" dominant-baseline="middle" text-anchor="middle" fill="#3b82f6" font-family="Montserrat,sans-serif" font-size="7" font-weight="900">26</text>
        </svg>
        <span class="logo-txt">GOBO<span>26</span></span>
    </a>
    <span class="hdr-title">Cascada Numèrica</span>
</header>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONES SVG ---
        const Trophy = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
            </svg>
        );

        const RefreshCw = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );

        const Sparkles = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
            </svg>
        );

        const ArrowLeft = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
        );

        const Quote = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z" />
            </svg>
        );

        const Crown = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
            </svg>
        );

        const HelpCircle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const X = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const Home = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        );

        // --- CONFIGURACIÓ ---
        const LEVELS = {
            4: { label: 'Bàsic', cols: 5, rows: 2, color: 'bg-green-50 text-green-700 border-green-300' },
            5: { label: 'Inicial', cols: 5, rows: 3, color: 'bg-teal-50 text-teal-700 border-teal-300' },
            6: { label: 'Normal', cols: 7, rows: 3, color: 'bg-blue-50 text-blue-700 border-blue-300' },
            7: { label: 'Difícil', cols: 7, rows: 4, color: 'bg-indigo-50 text-indigo-700 border-indigo-300' },
            8: { label: 'Avançat', cols: 6, rows: 6, color: 'bg-purple-50 text-purple-700 border-purple-300' },
            9: { label: 'Complexe', cols: 9, rows: 5, color: 'bg-pink-50 text-pink-700 border-pink-300' },
            10: { label: 'Impossible', cols: 11, rows: 5, color: 'bg-red-50 text-red-700 border-red-300' }
        };

        const PHRASES = [
            "La paciència és l'art de saber esperar amb un somriure.",
            "Avui és un dia perfecte per superar-se a un mateix.",
            "No comptis els dies, fes que els dies comptin.",
            "L'error és només una oportunitat per començar de nou amb més experiència.",
            "La constància és el pont entre el desig i la realitat.",
            "Si caus set vegades, aixeca't vuit.",
            "La felicitat es troba en les petites victòries de cada dia.",
            "Més val maña que força... sobretot en matemàtiques!",
            "Respira fons i gaudeix del joc, sense pressa.",
            "El millor mestre és el teu darrer error.",
            "No tot ha de sortir perfecte perquè valgui la pena.",
            "Avui també és un bon dia per fer-ho una mica millor que ahir.",
            "La calma també és una forma de valentia.",
            "Fer les coses a la teva manera també és avançar.",
            "El teu ritme també és un ritme vàlid.",
            "De vegades descansar és la millor decisió del dia."
        ];

        // --- FUNCIONS AUXILIARS ---
        const vibrate = (pattern) => {
            if (typeof navigator !== 'undefined' && navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        };

        const playSound = (type) => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            const now = ctx.currentTime;
            
            if (type === 'pop') {
                // So suau de clic
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(400, now + 0.08);
                gain.gain.setValueAtTime(0.08, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);
                osc.start(now);
                osc.stop(now + 0.08);
                vibrate(8);
            } else if (type === 'match') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(500, now);
                osc.frequency.linearRampToValueAtTime(700, now + 0.12);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.25);
                osc.start(now);
                osc.stop(now + 0.25);
                vibrate(15);
            } else if (type === 'solved') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.setValueAtTime(800, now + 0.1);
                osc.frequency.setValueAtTime(1000, now + 0.2);
                gain.gain.setValueAtTime(0.12, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
                vibrate([25, 40, 25]);
            } else if (type === 'error') {
                // So molt suau d'error
                osc.type = 'sine';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(200, now + 0.1);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
                vibrate([40, 20, 40]);
            } else if (type === 'newRecord') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(500, now);
                osc.frequency.setValueAtTime(600, now + 0.1);
                osc.frequency.setValueAtTime(700, now + 0.2);
                osc.frequency.setValueAtTime(900, now + 0.3);
                gain.gain.setValueAtTime(0.15, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.8);
                osc.start(now);
                osc.stop(now + 0.8);
                vibrate([80, 40, 80, 40, 150]);
            }
        };

        const getNumberColor = (num) => {
            const colors = {
                1: 'bg-yellow-200 border-yellow-400 text-yellow-800',
                2: 'bg-blue-200 border-blue-400 text-blue-800',
                3: 'bg-green-200 border-green-400 text-green-800',
                4: 'bg-red-200 border-red-400 text-red-800',
                5: 'bg-orange-200 border-orange-400 text-orange-800',
                6: 'bg-purple-200 border-purple-400 text-purple-800',
                7: 'bg-teal-200 border-teal-400 text-teal-800',
                8: 'bg-pink-200 border-pink-400 text-pink-800',
                9: 'bg-rose-300 border-rose-500 text-rose-900',
                10: 'bg-slate-300 border-slate-500 text-slate-800',
            };
            return colors[num] || 'bg-gray-200';
        };

        // Detectar si és mòbil
        const isMobile = () => {
            return window.innerWidth < 768;
        };

        // --- COMPONENT GOBO26 ---
        const Gobo26Logo = () => (
            <a 
                href="https://ja.cat/appgobo" 
                target="_self" 
                rel="noopener noreferrer"
                className="hidden sm:flex items-center gap-2 opacity-60 hover:opacity-100 transition-opacity"
                title="Gobo26"
            >
                <svg width="32" height="32" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <polygon points="50,2 93,26 93,74 50,98 7,74 7,26" fill="#1e293b" stroke="#94a3b8" strokeWidth="2"/>
                    <text x="50" y="42" textAnchor="middle" fill="white" fontSize="22" fontWeight="800" fontFamily="sans-serif">GOBO</text>
                    <text x="50" y="65" textAnchor="middle" fill="#94a3b8" fontSize="20" fontWeight="700" fontFamily="sans-serif">26</text>
                </svg>
            </a>
        );

        const Gobo26Footer = () => (
            <div className="flex items-center justify-center gap-2 py-4 mt-4 opacity-40 hover:opacity-70 transition-opacity">
                <a 
                    href="https://ja.cat/appgobo" 
                    target="_self" 
                    rel="noopener noreferrer"
                    className="flex items-center gap-2 text-xs text-slate-500"
                >
                    <svg width="16" height="16" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <polygon points="50,2 93,26 93,74 50,98 7,74 7,26" fill="#475569"/>
                        <text x="50" y="44" textAnchor="middle" fill="white" fontSize="26" fontWeight="800" fontFamily="sans-serif">G</text>
                        <text x="50" y="68" textAnchor="middle" fill="#cbd5e1" fontSize="22" fontWeight="700" fontFamily="sans-serif">26</text>
                    </svg>
                    <span>Una aplicació de Gobo26</span>
                </a>
            </div>
        );

        // --- COMPONENT CONFETI ---
        const Confetti = () => {
            const pieces = Array.from({ length: 50 }, (_, i) => ({
                id: i,
                left: Math.random() * 100,
                delay: Math.random() * 0.5,
                duration: 2 + Math.random() * 2,
                color: ['bg-yellow-400', 'bg-blue-400', 'bg-red-400', 'bg-green-400', 'bg-purple-400', 'bg-pink-400'][Math.floor(Math.random() * 6)]
            }));

            return (
                <div className="fixed inset-0 pointer-events-none z-50 overflow-hidden">
                    {pieces.map(piece => (
                        <div
                            key={piece.id}
                            className={`absolute w-3 h-3 ${piece.color} rounded-sm`}
                            style={{
                                left: `${piece.left}%`,
                                top: '-20px',
                                animation: `fall ${piece.duration}s linear ${piece.delay}s forwards`,
                                transform: `rotate(${Math.random() * 360}deg)`
                            }}
                        />
                    ))}
                </div>
            );
        };

        // --- COMPONENT PRINCIPAL ---
        const App = () => {
            const [gameState, setGameState] = useState('menu');
            const [selectedLevel, setSelectedLevel] = useState(6);
            const [grid, setGrid] = useState([]);
            const [clicks, setClicks] = useState(0);
            const [targetNumber, setTargetNumber] = useState(null);
            const [isProcessing, setIsProcessing] = useState(false);
            const [message, setMessage] = useState("");
            const [dailyPhrase, setDailyPhrase] = useState("");
            const [bestScores, setBestScores] = useState({});
            const [isNewRecord, setIsNewRecord] = useState(false);
            const [showRules, setShowRules] = useState(false);
            const [showConfetti, setShowConfetti] = useState(false);
            const [errorCell, setErrorCell] = useState(null);
            const [mobile, setMobile] = useState(isMobile());

            useEffect(() => {
                const handleResize = () => {
                    setMobile(isMobile());
                };
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            useEffect(() => {
                const savedScores = localStorage.getItem('cascadaScores');
                let parsedScores = savedScores ? JSON.parse(savedScores) : {};
                let scoresUpdated = false;

                Object.keys(LEVELS).forEach(lvl => {
                    if (!parsedScores[lvl]) {
                        const levelNum = parseInt(lvl);
                        const totalCells = (levelNum * (levelNum + 1)) / 2;
                        const randomRecord = totalCells + Math.floor(Math.random() * 16) + 15;
                        parsedScores[lvl] = randomRecord;
                        scoresUpdated = true;
                    }
                });

                if (scoresUpdated || !savedScores) {
                    localStorage.setItem('cascadaScores', JSON.stringify(parsedScores));
                }
                
                setBestScores(parsedScores);
                setDailyPhrase(PHRASES[Math.floor(Math.random() * PHRASES.length)]);
            }, []);

            const startGame = (level) => {
                setSelectedLevel(level);
                
                let numbers = [];
                for (let i = 1; i <= level; i++) {
                    for (let j = 0; j < i; j++) {
                        numbers.push(i);
                    }
                }

                for (let i = numbers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
                }

                const newGrid = numbers.map((val, index) => ({
                    id: index,
                    value: val,
                    status: 'hidden',
                }));

                setGrid(newGrid);
                setClicks(0);
                setTargetNumber(null);
                setGameState('playing');
                setMessage("Clica una casella per començar!");
                setIsProcessing(false);
                setIsNewRecord(false);
                setShowConfetti(false);
                setErrorCell(null);
                setDailyPhrase(PHRASES[Math.floor(Math.random() * PHRASES.length)]);
            };

            const handleCardClick = (index) => {
                if (isProcessing || gameState !== 'playing') return;
                
                const clickedCard = grid[index];
                if (clickedCard.status !== 'hidden') return;

                playSound('pop');
                setClicks(prev => prev + 1);

                const newGrid = [...grid];
                newGrid[index].status = 'visible';
                setGrid(newGrid);
                setErrorCell(null);

                if (targetNumber === null) {
                    if (clickedCard.value === 1) {
                        playSound('solved');
                        newGrid[index].status = 'solved';
                        setGrid(newGrid);
                        setMessage("L'u trobat! Continua.");
                        checkWinCondition(newGrid);
                    } else {
                        setTargetNumber(clickedCard.value);
                        setMessage(`Busca els ${clickedCard.value}! En falten ${clickedCard.value - 1}.`);
                    }
                } else {
                    if (clickedCard.value === targetNumber) {
                        const allTargetCards = newGrid.filter(c => c.value === targetNumber);
                        const visibleTargetCards = allTargetCards.filter(c => c.status === 'visible');
                        
                        if (visibleTargetCards.length === targetNumber) {
                            playSound('solved');
                            const solvedGrid = newGrid.map(c => 
                                c.value === targetNumber ? { ...c, status: 'solved' } : c
                            );
                            setGrid(solvedGrid);
                            setTargetNumber(null);
                            setMessage(`Perfecte! Has trobat tots els ${clickedCard.value}.`);
                            checkWinCondition(solvedGrid);
                        } else {
                            playSound('match');
                            const remaining = targetNumber - visibleTargetCards.length;
                            setMessage(`Bé! Falten ${remaining} número${remaining > 1 ? 's' : ''} ${targetNumber}.`);
                        }
                    } else {
                        playSound('error');
                        setIsProcessing(true);
                        setErrorCell(index);
                        setMessage(`Ups! És un ${clickedCard.value}. Es reinicia la sèrie del ${targetNumber}.`);
                        
                        // Pausa més curta: de 1500ms a 800ms
                        setTimeout(() => {
                            const resetGrid = newGrid.map(c => {
                                if (c.id === index) return { ...c, status: 'hidden' };
                                if (c.value === targetNumber && c.status === 'visible') return { ...c, status: 'hidden' };
                                return c;
                            });
                            
                            setGrid(resetGrid);
                            setTargetNumber(null);
                            setIsProcessing(false);
                            setErrorCell(null);
                            setMessage("Torna-hi! Busca una nova parella.");
                        }, 800);
                    }
                }
            };

            const checkWinCondition = (currentGrid) => {
                const allSolved = currentGrid.every(c => c.status === 'solved');
                if (allSolved) {
                    setGameState('finished');
                    
                    const currentBest = bestScores[selectedLevel];
                    const finalClicks = clicks + 1;

                    if (finalClicks < currentBest) {
                        setIsNewRecord(true);
                        setShowConfetti(true);
                        playSound('newRecord');
                        setMessage("INCREÏBLE! NOU RÈCORD ACONSEGUIT!");
                        
                        const newScores = { ...bestScores, [selectedLevel]: finalClicks };
                        setBestScores(newScores);
                        localStorage.setItem('cascadaScores', JSON.stringify(newScores));
                    } else {
                        setShowConfetti(true);
                        playSound('solved');
                        setMessage("FELICITATS! Has completat la cascada!");
                    }
                }
            };

            const getGridColsClass = (level) => {
                // En mòbil, invertir files i columnes per grid vertical
                if (mobile) {
                    const mapping = {
                        4: 'grid-cols-2',  // 2 cols x 5 rows
                        5: 'grid-cols-3',  // 3 cols x 5 rows
                        6: 'grid-cols-3',  // 3 cols x 7 rows
                        7: 'grid-cols-4',  // 4 cols x 7 rows
                        8: 'grid-cols-6',  // 6 cols x 6 rows
                        9: 'grid-cols-5',  // 5 cols x 9 rows
                        10: 'grid-cols-5'  // 5 cols x 11 rows
                    };
                    return mapping[level] || 'grid-cols-5';
                } else {
                    const mapping = {
                        4: 'grid-cols-5',
                        5: 'grid-cols-5',
                        6: 'grid-cols-7',
                        7: 'grid-cols-7',
                        8: 'grid-cols-6',
                        9: 'grid-cols-9',
                        10: 'grid-cols-11'
                    };
                    return mapping[level] || 'grid-cols-5';
                }
            };

            const RulesModal = () => (
                <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                <HelpCircle className="w-6 h-6 text-blue-500" /> Com jugar
                            </h2>
                            <button onClick={() => setShowRules(false)} className="text-slate-400 hover:text-slate-600 p-1">
                                <X className="w-6 h-6" />
                            </button>
                        </div>
                        
                        <div className="space-y-4 text-slate-600 text-sm">
                            <div className="flex gap-3 items-start">
                                <span className="bg-blue-100 text-blue-700 font-bold rounded-full w-7 h-7 flex items-center justify-center shrink-0 mt-0.5">1</span>
                                <p><strong>Objectiu:</strong> Destapa totes les caselles de la graella.</p>
                            </div>
                            <div className="flex gap-3 items-start">
                                <span className="bg-blue-100 text-blue-700 font-bold rounded-full w-7 h-7 flex items-center justify-center shrink-0 mt-0.5">2</span>
                                <p><strong>La Regla d'Or:</strong> Quan trobes un número (per exemple, un <strong>3</strong>), has de trobar els altres dos 3s <strong>de forma consecutiva</strong>.</p>
                            </div>
                            <div className="flex gap-3 items-start">
                                <span className="bg-red-100 text-red-700 font-bold rounded-full w-7 h-7 flex items-center justify-center shrink-0 mt-0.5">!</span>
                                <p><strong>Compte!</strong> Si falles mentre busques una sèrie, tots els números d'aquella sèrie es tornen a amagar.</p>
                            </div>
                            <div className="flex gap-3 items-start">
                                <span className="bg-blue-100 text-blue-700 font-bold rounded-full w-7 h-7 flex items-center justify-center shrink-0 mt-0.5">3</span>
                                <p>El número <strong>1</strong> es resol sol. El número <strong>9</strong> requereix 9 encerts seguits sense error!</p>
                            </div>
                        </div>

                        <button 
                            onClick={() => setShowRules(false)}
                            className="mt-6 w-full bg-slate-800 text-white py-3 rounded-lg font-medium hover:bg-slate-700 transition-colors"
                        >
                            Entesos!
                        </button>
                    </div>
                </div>
            );

            if (gameState === 'menu') {
                return (
                    <div className="min-h-screen p-4 sm:p-6 font-sans text-slate-700 flex flex-col items-center justify-center" style={{backgroundColor:'#f1f5f9'}}>
                        <div className="max-w-4xl w-full text-center space-y-6 sm:space-y-8">
                            
                            <div className="flex justify-end w-full">
                                <Gobo26Logo />
                            </div>

                            <div className="space-y-3">
                                <h1 className="text-3xl sm:text-4xl md:text-5xl font-extrabold text-slate-800 tracking-tight">
                                    Cascada Numèrica
                                </h1>
                                <div className="flex items-center justify-center gap-2 text-slate-500 italic text-sm sm:text-base px-4">
                                    <Quote className="w-4 h-4 shrink-0 transform scale-x-[-1]" />
                                    <p className="line-clamp-2">{dailyPhrase}</p>
                                    <Quote className="w-4 h-4 shrink-0" />
                                </div>
                            </div>

                            <div className="bg-white p-4 sm:p-8 rounded-2xl shadow-xl border border-slate-200 relative">
                                <button 
                                    onClick={() => setShowRules(true)}
                                    className="absolute top-3 right-3 sm:top-4 sm:right-4 p-2 text-slate-400 hover:text-blue-500 hover:bg-blue-50 rounded-full transition-all"
                                    title="Com jugar"
                                >
                                    <HelpCircle className="w-5 h-5 sm:w-6 sm:h-6" />
                                </button>

                                <h2 className="text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-slate-600 pr-10">
                                    Tria el teu repte:
                                </h2>
                                
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                                    {[4, 5, 6, 7, 8, 9, 10].map((level) => (
                                        <button
                                            key={level}
                                            onClick={() => startGame(level)}
                                            className={`
                                                relative group flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4 rounded-xl border-2 transition-all duration-200
                                                hover:scale-105 active:scale-95 shadow-sm hover:shadow-md
                                                ${LEVELS[level].color}
                                            `}
                                        >
                                            <div className="flex flex-col items-start">
                                                <span className="font-bold text-base sm:text-lg">{LEVELS[level].label}</span>
                                                <span className="text-xs opacity-75">Nivell {level}</span>
                                            </div>
                                            {bestScores[level] && (
                                                <div className="flex items-center gap-1 bg-white/70 px-2 py-1 rounded-full text-xs font-mono text-slate-700">
                                                    <Trophy className="w-3 h-3" />
                                                    <span className="font-bold">{bestScores[level]}</span>
                                                </div>
                                            )}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                        {showRules && <RulesModal />}
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-3 sm:p-4 font-sans text-slate-700 flex flex-col items-center" style={{backgroundColor:'#f1f5f9'}}>
                    
                    {showConfetti && <Confetti />}
                    
                    <div className="max-w-6xl w-full flex flex-col gap-3 mb-4 sm:mb-6">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2 sm:gap-4">
                                <button 
                                    onClick={() => setGameState('menu')}
                                    className="p-2 hover:bg-white rounded-full transition-colors"
                                    title="Tornar al menú"
                                >
                                    <ArrowLeft className="w-5 h-5 sm:w-6 sm:h-6 text-slate-600" />
                                </button>
                                <div className="flex items-center gap-2">
                                    <div>
                                        <h1 className="text-lg sm:text-2xl font-bold text-slate-800">Cascada Numèrica</h1>
                                        <span className={`text-[10px] sm:text-xs px-2 py-0.5 rounded-full border ${LEVELS[selectedLevel].color}`}>
                                            {LEVELS[selectedLevel].label}
                                        </span>
                                    </div>
                                    <button 
                                        onClick={() => setShowRules(true)}
                                        className="p-1.5 text-slate-400 hover:text-blue-500 hover:bg-white rounded-full transition-all"
                                        title="Ajuda"
                                    >
                                        <HelpCircle className="w-4 h-4 sm:w-5 sm:h-5" />
                                    </button>
                                </div>
                            </div>
                            
                            <div className="flex gap-2 items-center">
                                {gameState === 'finished' && (
                                    <button 
                                        onClick={() => setGameState('menu')}
                                        className="flex items-center gap-1 bg-white text-slate-700 border border-slate-300 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors shadow-sm"
                                    >
                                        <Home className="w-4 h-4" />
                                        <span className="hidden sm:inline text-sm">Menú</span>
                                    </button>
                                )}
                                
                                <button 
                                    onClick={() => startGame(selectedLevel)}
                                    className="flex items-center gap-1 sm:gap-2 bg-slate-800 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-slate-700 transition-colors shadow-md"
                                >
                                    <RefreshCw className="w-4 h-4" />
                                    <span className="text-sm sm:inline">{gameState === 'finished' ? 'Altra' : 'Reiniciar'}</span>
                                </button>
                                <Gobo26Logo />
                            </div>
                        </div>

                        <div className="flex gap-2 sm:gap-4 items-center justify-center sm:justify-start">
                            <div className="bg-white px-3 sm:px-4 py-2 rounded-lg shadow-sm flex flex-col items-center border border-slate-200">
                                <span className="text-[9px] sm:text-[10px] text-slate-400 uppercase tracking-wider font-bold">Rècord</span>
                                <div className="flex items-center gap-1 text-slate-500">
                                    <Trophy className="w-3 h-3" />
                                    <span className="font-mono font-bold text-base sm:text-lg leading-none">{bestScores[selectedLevel]}</span>
                                </div>
                            </div>

                            <div className="bg-white px-3 sm:px-4 py-2 rounded-lg shadow-sm flex flex-col items-center border-2 border-slate-800">
                                <span className="text-[9px] sm:text-[10px] text-slate-500 uppercase tracking-wider font-bold">Clics</span>
                                <span className="font-mono font-bold text-xl sm:text-2xl leading-none text-slate-800">{clicks}</span>
                            </div>
                        </div>
                    </div>

                    <div className="mb-3 sm:mb-4 text-slate-500 italic text-xs sm:text-sm text-center flex gap-2 justify-center items-center px-4">
                        <Quote className="w-3 h-3 shrink-0 transform scale-x-[-1]" />
                        <p className="line-clamp-1">{dailyPhrase}</p>
                        <Quote className="w-3 h-3 shrink-0" />
                    </div>

                    {isNewRecord && (
                        <div className="mb-4 sm:mb-6 w-full max-w-2xl bg-gradient-to-r from-yellow-400 to-orange-400 text-yellow-900 px-4 py-3 sm:px-6 sm:py-4 rounded-xl shadow-lg transform animate-bounce flex items-center justify-center gap-2 sm:gap-3 border-4 border-yellow-200">
                            <Crown className="w-6 h-6 sm:w-8 sm:h-8" />
                            <span className="text-lg sm:text-2xl font-black tracking-wide sm:tracking-wider">NOU RÈCORD!</span>
                            <Crown className="w-6 h-6 sm:w-8 sm:h-8" />
                        </div>
                    )}

                    {!isNewRecord && (
                        <div className={`mb-4 sm:mb-6 px-4 sm:px-6 py-2 sm:py-3 rounded-full shadow-md text-center font-medium transition-all duration-300 w-full max-w-2xl text-sm sm:text-base ${
                            gameState === 'finished' ? 'bg-green-600 text-white scale-105' : 
                            targetNumber ? 'bg-blue-600 text-white' : 'bg-white text-slate-600'
                        }`}>
                            {message}
                        </div>
                    )}

                    <div className="bg-white p-3 sm:p-6 rounded-xl shadow-xl border border-slate-200 inline-block w-full max-w-full overflow-x-auto">
                        <div className={`grid ${getGridColsClass(selectedLevel)} gap-1.5 sm:gap-2 md:gap-3 justify-center mx-auto`}
                             style={{ maxWidth: 'fit-content' }}>
                            {grid.map((cell, index) => (
                                <button
                                    key={cell.id}
                                    onClick={() => handleCardClick(index)}
                                    disabled={cell.status === 'solved' || (cell.status === 'visible' && cell.value !== targetNumber)}
                                    className={`
                                        relative w-10 h-10 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-lg flex items-center justify-center 
                                        text-xl sm:text-2xl md:text-3xl font-bold shadow-sm
                                        transition-all duration-300 transform
                                        ${gameState === 'finished' ? 'animate-pulse' : ''} 
                                        ${cell.status === 'hidden' 
                                            ? 'bg-slate-200 hover:bg-slate-300 cursor-pointer active:scale-95 hover:shadow-md' 
                                            : ''}
                                        ${cell.status === 'visible' 
                                            ? `${getNumberColor(cell.value)} shadow-inner scale-105 border-2` 
                                            : ''}
                                        ${cell.status === 'solved' 
                                            ? 'bg-green-100 text-green-700 border-2 border-green-300 shadow-none cursor-default' 
                                            : ''}
                                        ${errorCell === index ? 'animate-shake bg-red-500 border-red-700' : ''}
                                    `}
                                    style={{
                                        animationDelay: gameState === 'finished' ? `${index * 50}ms` : '0ms'
                                    }}
                                >
                                    {cell.status === 'hidden' && (
                                        <Sparkles className="w-4 h-4 sm:w-5 sm:h-5 text-slate-400 opacity-40" />
                                    )}
                                    
                                    <div className={`transition-opacity duration-300 ${cell.status === 'hidden' ? 'opacity-0' : 'opacity-100'}`}>
                                        {cell.value}
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    {showRules && <RulesModal />}
                </div>
            );
        };

        // Renderitzar l'aplicació
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<footer style="font-size:.72rem;color:#94a3b8;font-weight:600;text-align:center;padding:16px;margin-top:auto;border-top:1px solid #1e2d45;">
    <a href="https://ja.cat/appgobo"
       style="display:inline-flex;align-items:center;gap:6px;opacity:0.4;transition:opacity 0.2s;color:#94a3b8;text-decoration:none;"
       onmouseover="this.style.opacity=0.8" onmouseout="this.style.opacity=0.4">
        <svg width="13" height="13" viewBox="0 0 100 100" fill="none"><polygon points="50,2 93,26 93,74 50,98 7,74 7,26" fill="#94a3b8"/><text x="50" y="44" text-anchor="middle" fill="white" font-size="26" font-weight="800" font-family="sans-serif">G</text><text x="50" y="68" text-anchor="middle" fill="#1e293b" font-size="22" font-weight="700" font-family="sans-serif">26</text></svg>
        Una aplicació de Gobo26
    </a>
</footer>
</body>
</html>
