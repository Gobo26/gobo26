<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mercatus Â· Gobo26</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
:root{
    --bg:#f1f5f9;--s200:#e2e8f0;--s300:#cbd5e1;--s400:#94a3b8;
    --s600:#475569;--s700:#334155;--s800:#1e293b;
    --blue:#2563eb;--blue2:#3b82f6;
    --ok:#16a34a;--okl:#dcfce7;
    --err:#dc2626;--errl:#fee2e2;
    --gold:#f59e0b;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Montserrat',sans-serif;background:var(--bg);min-height:100vh;display:flex;flex-direction:column;align-items:center;}

/* HEADER */
.top-header{width:100%;background:var(--s800);padding:10px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
.logo{display:flex;align-items:center;gap:8px;text-decoration:none;}
.logo-txt{font-size:1rem;font-weight:900;color:white;letter-spacing:-0.5px;}
.logo-txt span{color:var(--blue2);}
.hdr-title{font-size:.95rem;font-weight:700;color:white;letter-spacing:.5px;}
#btn-ajuda{font-family:'Montserrat',sans-serif;font-size:1.1rem;font-weight:900;width:38px;height:38px;border-radius:50%;border:2px solid var(--blue2);background:var(--blue);color:white;cursor:pointer;transition:background .2s,transform .15s;box-shadow:0 2px 8px rgba(37,99,235,.5);}
#btn-ajuda:hover{background:var(--blue2);transform:scale(1.1);}

main{width:100%;max-width:650px;padding:16px 12px;display:flex;flex-direction:column;align-items:center;gap:14px;flex:1;}

/* CARDS */
.card{width:100%;background:white;border-radius:14px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.08);}

/* â”€â”€ PANTALLA INICI â”€â”€ */
.niv-llista{display:flex;flex-direction:column;gap:10px;margin-top:4px;}
.btn-niv{font-family:'Montserrat',sans-serif;background:white;border:2px solid var(--s200);border-radius:12px;padding:14px 16px;width:100%;text-align:left;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all .15s;color:var(--s800);}
.btn-niv:hover{border-color:var(--blue2);background:#eff6ff;transform:translateX(4px);}
.btn-niv .niv-nom{font-size:1rem;font-weight:700;}
.btn-niv .niv-desc{font-size:.78rem;color:var(--s400);margin-top:2px;}
.btn-niv .niv-rec{font-size:.85rem;font-weight:900;color:var(--blue);text-align:right;white-space:nowrap;}
.niv-left{display:flex;flex-direction:column;}

/* â”€â”€ PANTALLA JOC â”€â”€ */
#p-joc{display:none;}

/* Tiquet */
.tiquet{background:#fffdf7;border:1px dashed var(--s300);border-radius:10px;padding:16px 14px;margin-bottom:14px;font-family:'Montserrat',sans-serif;}
.tiquet-cap{text-align:center;font-size:.7rem;font-weight:700;letter-spacing:2px;color:var(--s600);text-transform:uppercase;padding-bottom:10px;border-bottom:1px dashed var(--s300);margin-bottom:12px;}
.tiquet-item{display:flex;align-items:flex-end;margin-bottom:8px;font-size:.95rem;}
.item-info{flex:0 0 auto;display:flex;flex-direction:column;}
.item-nom{font-weight:700;color:var(--s800);}
.item-det{font-size:.72rem;color:var(--s400);font-style:italic;}
.item-punts{flex:1;border-bottom:1px dotted var(--s300);margin:0 8px 4px;}
.item-preu{font-weight:900;color:var(--s800);flex-shrink:0;}
.tiquet-total{border-top:2px solid var(--s800);margin-top:12px;padding-top:10px;display:flex;justify-content:space-between;align-items:center;}
.tiquet-total-txt{font-size:.8rem;font-weight:700;color:var(--s600);text-transform:uppercase;letter-spacing:1px;}
.tiquet-total-val{font-size:1.6rem;font-weight:900;color:var(--blue);letter-spacing:1px;}

/* Info bar */
.info-bar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:12px;}
.badge{font-size:.72rem;font-weight:700;padding:5px 12px;border-radius:99px;background:var(--s200);color:var(--s700);}
.badge.bo{background:var(--okl);color:var(--ok);}
.badge.mal{background:var(--errl);color:var(--err);}
.badge.gold{background:#fef3c7;color:#92400e;}

/* Opcions */
.zona-opcions{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:12px;}
.btn-op{font-family:'Montserrat',sans-serif;font-size:1.1rem;font-weight:900;padding:14px 6px;border-radius:12px;border:2px solid var(--s300);background:white;color:var(--s800);cursor:pointer;box-shadow:0 4px 0 var(--s300);transition:transform .1s,box-shadow .1s,border-color .15s;width:100%;}
.btn-op:hover:not(:disabled){border-color:var(--blue2);transform:translateY(-2px);box-shadow:0 6px 0 var(--blue2);}
.btn-op:active:not(:disabled){transform:translateY(4px);box-shadow:none;}
.btn-op.correcte{background:var(--ok)!important;border-color:var(--ok)!important;color:white!important;box-shadow:0 4px 0 #166534!important;}
.btn-op.incorrecte{background:var(--err)!important;border-color:var(--err)!important;color:white!important;box-shadow:0 4px 0 #991b1b!important;opacity:.7;}
.btn-op.desactivat{cursor:default;}

#missatge{text-align:center;font-weight:700;min-height:28px;font-size:1rem;margin-bottom:4px;}
#btn-next{width:100%;padding:14px;background:var(--blue);color:white;border:none;border-radius:12px;font-family:'Montserrat',sans-serif;font-size:1rem;font-weight:900;cursor:pointer;box-shadow:0 4px 0 #1d4ed8;display:none;transition:opacity .2s;}
#btn-next:hover{opacity:.9;}

/* â”€â”€ RÃˆCORDS / ESTADÃSTIQUES â”€â”€ */
#record-panel{width:100%;max-width:650px;background:white;border:2px solid var(--s200);padding:16px 20px;border-radius:12px;display:none;}
#record-panel h3{color:var(--s700);font-size:.85rem;text-transform:uppercase;letter-spacing:2px;margin-bottom:8px;}
.rec-caps{display:grid;grid-template-columns:1fr 70px 70px;font-size:.7rem;font-weight:700;color:var(--s400);text-transform:uppercase;padding:0 4px;margin-bottom:4px;text-align:center;}
.rec-row{display:grid;grid-template-columns:1fr 70px 70px;padding:6px 4px;border-bottom:1px solid var(--s200);font-size:.82rem;font-weight:700;color:var(--s700);text-align:center;align-items:center;}
.rec-row:last-child{border-bottom:none;}
.rec-row span:first-child{text-align:left;}
.rec-row .val{color:var(--blue);font-size:.8rem;}

#estadistiques{width:100%;max-width:650px;background:white;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);display:none;}
#estadistiques h2{text-align:center;font-size:1rem;font-weight:900;color:var(--s800);text-transform:uppercase;letter-spacing:2px;margin-bottom:14px;}
.fila-stat{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f1f5f9;font-size:.9rem;}
.fila-stat:last-of-type{border-bottom:none;}
.stat-val{font-weight:900;color:var(--blue);}

/* MODALS */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:200;align-items:center;justify-content:center;}
.modal-overlay.show{display:flex;}
.modal-box{background:white;border-radius:20px;padding:28px 24px 22px;max-width:400px;width:92%;box-shadow:0 20px 60px rgba(0,0,0,.3);animation:popIn .3s cubic-bezier(.175,.885,.32,1.275);}
@keyframes popIn{from{transform:scale(.85);opacity:0}to{transform:scale(1);opacity:1}}
.modal-box h2{font-size:1.2rem;margin-bottom:14px;color:var(--s800);}
.ajuda-pas{display:flex;gap:12px;margin-bottom:12px;align-items:flex-start;font-size:.88rem;line-height:1.5;color:var(--s700);}
.ajuda-ico{font-size:1.4rem;flex-shrink:0;}
.ajuda-niv{background:#f8fafc;border-radius:8px;padding:10px 12px;margin:10px 0;font-size:.82rem;line-height:1.7;color:var(--s700);}
.ajuda-niv strong{color:var(--s800);}
#btn-tancar-ajuda{width:100%;font-family:'Montserrat',sans-serif;font-size:.9rem;font-weight:700;padding:12px;background:var(--s800);color:white;border:none;border-radius:99px;cursor:pointer;margin-top:10px;}

.confeti{position:fixed;border-radius:2px;pointer-events:none;z-index:300;animation:confetti-fall 2.2s ease-in forwards;}
@keyframes confetti-fall{to{transform:translateY(110vh) rotate(720deg);opacity:0}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
@keyframes apareixer{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}

footer{font-size:.72rem;color:var(--s400);font-weight:600;text-align:center;padding:16px;margin-top:auto;}
@media(max-width:420px){.zona-opcions{grid-template-columns:repeat(2,1fr);}.logo-txt{display:none;}}
</style>
</head>
<body>

<header class="top-header">
    <a href="https://ja.cat/gobo26" target="_blank" class="logo">
        <svg width="38" height="38" viewBox="0 0 40 40" fill="none">
            <polygon points="20,2 36,11 36,29 20,38 4,29 4,11" fill="#1e293b" stroke="#3b82f6" stroke-width="2"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="white" font-family="Montserrat,sans-serif" font-size="8" font-weight="900">GOBO</text>
            <text x="50%" y="72%" dominant-baseline="middle" text-anchor="middle" fill="#3b82f6" font-family="Montserrat,sans-serif" font-size="7" font-weight="900">26</text>
        </svg>
        <span class="logo-txt">GOBO<span>26</span></span>
    </a>
    <span class="hdr-title">MERCATUS</span>
    <button id="btn-ajuda" onclick="mostrarAjuda()">?</button>
</header>

<main>
    <!-- PANTALLA INICI -->
    <div class="card" id="p-inici">
        <h3 style="font-size:.75rem;font-weight:700;color:var(--s400);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:14px;text-align:center;">Tria el nivell de dificultat</h3>
        <div class="niv-llista">
            <button class="btn-niv" onclick="iniciar(1)">
                <div class="niv-left">
                    <span class="niv-nom">ğŸ›’ Nivell 1 â€” Mercat fÃ cil</span>
                    <span class="niv-desc">4 productes Â· Preus d'1 a 7 â‚¬</span>
                </div>
                <span class="niv-rec">ğŸ† <span id="rec-1">â€”</span></span>
            </button>
            <button class="btn-niv" onclick="iniciar(2)">
                <div class="niv-left">
                    <span class="niv-nom">ğŸ§º Nivell 2 â€” Compra setmanal</span>
                    <span class="niv-desc">5 productes Â· Preus de 7 a 12 â‚¬</span>
                </div>
                <span class="niv-rec">ğŸ† <span id="rec-2">â€”</span></span>
            </button>
            <button class="btn-niv" onclick="iniciar(3)">
                <div class="niv-left">
                    <span class="niv-nom">ğŸª Nivell 3 â€” Supermercat</span>
                    <span class="niv-desc">6 productes Â· Preus de 12 a 76 â‚¬</span>
                </div>
                <span class="niv-rec">ğŸ† <span id="rec-3">â€”</span></span>
            </button>
            <button class="btn-niv" onclick="iniciar(4)">
                <div class="niv-left">
                    <span class="niv-nom">ğŸ¬ Nivell 4 â€” Gran compra</span>
                    <span class="niv-desc">7 productes Â· Preus de 32 a 127 â‚¬</span>
                </div>
                <span class="niv-rec">ğŸ† <span id="rec-4">â€”</span></span>
            </button>
        </div>
    </div>

    <!-- PANTALLA JOC -->
    <div id="p-joc">
        <div class="info-bar">
            <span class="badge" id="badge-niv">Nivell 1</span>
            <span class="badge bo" id="badge-ratxa">ğŸ¯ Ratxa: 0</span>
            <span class="badge gold" id="badge-rec">ğŸ† RÃ¨cord: â€”</span>
        </div>

        <div class="card">
            <!-- Tiquet -->
            <div class="tiquet">
                <div class="tiquet-cap">ğŸ›’ Mercatus</div>
                <ul id="llista" style="list-style:none;padding:0;margin:0;"></ul>
                <div class="tiquet-total">
                    <span class="tiquet-total-txt">Total a pagar</span>
                    <span class="tiquet-total-val">??? â‚¬</span>
                </div>
            </div>

            <!-- Missatge -->
            <div id="missatge"></div>

            <!-- Opcions -->
            <div class="zona-opcions" id="opcions"></div>

            <!-- BotÃ³ SegÃ¼ent -->
            <button id="btn-next" onclick="novaRonda()">SegÃ¼ent tiquet â”</button>
        </div>

        <div style="text-align:center;margin-top:8px;">
            <button onclick="tornar()" style="font-family:'Montserrat',sans-serif;font-size:.82rem;font-weight:700;color:var(--s400);background:none;border:none;cursor:pointer;text-decoration:underline;">â†© MenÃº principal</button>
        </div>
    </div>

    <!-- RÃˆCORDS -->
    <div id="record-panel">
        <h3>ğŸ… Millors ratxes per nivell</h3>
        <div class="rec-caps"><span>Nivell</span><span>ğŸ† RÃ¨cord</span><span>ğŸ® Rondes</span></div>
        <div class="rec-row" id="rec-row-1" style="display:none"><span>ğŸ›’ Nivell 1</span><span class="val" id="recp-1">â€”</span><span class="val" id="rondes-1">â€”</span></div>
        <div class="rec-row" id="rec-row-2" style="display:none"><span>ğŸ§º Nivell 2</span><span class="val" id="recp-2">â€”</span><span class="val" id="rondes-2">â€”</span></div>
        <div class="rec-row" id="rec-row-3" style="display:none"><span>ğŸª Nivell 3</span><span class="val" id="recp-3">â€”</span><span class="val" id="rondes-3">â€”</span></div>
        <div class="rec-row" id="rec-row-4" style="display:none"><span>ğŸ¬ Nivell 4</span><span class="val" id="recp-4">â€”</span><span class="val" id="rondes-4">â€”</span></div>
    </div>

    <!-- ESTADÃSTIQUES -->
    <div id="estadistiques">
        <h2>ğŸ“Š EstadÃ­stiques</h2>
        <div class="fila-stat"><span>âœ… Respostes correctes</span><span class="stat-val" id="st-ok">0</span></div>
        <div class="fila-stat"><span>âŒ Respostes errÃ²nies</span><span class="stat-val" id="st-err">0</span></div>
        <div class="fila-stat"><span>ğŸ¯ Millor ratxa global</span><span class="stat-val" id="st-ratxa">0</span></div>
        <div class="fila-stat"><span>ğŸ® Rondes totals</span><span class="stat-val" id="st-total">0</span></div>
        <div style="text-align:center;margin-top:12px;">
            <span style="cursor:pointer;font-size:.8rem;color:var(--s600);text-decoration:underline;" onclick="esborrarDades()">Esborrar dades</span>
        </div>
    </div>
</main>

<!-- Modal Ajuda -->
<div id="modal-ajuda" class="modal-overlay">
    <div class="modal-box">
        <h2>â“ Com es juga?</h2>
        <div class="ajuda-pas"><span class="ajuda-ico">ğŸ§¾</span><span>Apareix un tiquet de supermercat amb productes i preus individuals. Has de calcular el total mentalment.</span></div>
        <div class="ajuda-pas"><span class="ajuda-ico">ğŸ‘†</span><span>Tria la resposta correcta entre les 6 opcions. AtenciÃ³: algunes opcions acaben amb el mateix dÃ­git per confondre't!</span></div>
        <div class="ajuda-pas"><span class="ajuda-ico">ğŸ”¥</span><span>Cada encert suma a la teva ratxa. Si t'equivoques, la ratxa torna a zero.</span></div>
        <div class="ajuda-niv">
            <strong>ğŸ›’ Niv. 1</strong> â€” 4 productes, preus baixos (1â€“7 â‚¬)<br>
            <strong>ğŸ§º Niv. 2</strong> â€” 5 productes, preus mitjans (7â€“12 â‚¬)<br>
            <strong>ğŸª Niv. 3</strong> â€” 6 productes, preus mÃ©s alts (12â€“76 â‚¬)<br>
            <strong>ğŸ¬ Niv. 4</strong> â€” 7 productes, preus grans (32â€“127 â‚¬)
        </div>
        <button id="btn-tancar-ajuda" onclick="tancarAjuda()">EntÃ¨s!</button>
    </div>
</div>

<footer><a href="https://ja.cat/gobo26" target="_blank" style="color:var(--s400);text-decoration:none;font-weight:700;">Una aplicaciÃ³ de Gobo26</a></footer>

<script>
// â”€â”€â”€ DADES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CONFIG = {
    1:{items:4,minP:1,maxP:7},
    2:{items:5,minP:7,maxP:12},
    3:{items:6,minP:12,maxP:76},
    4:{items:7,minP:32,maxP:127}
};

const PRODUCTES = [
    "Llet","Pa","Ous","ArrÃ²s","Pasta","Fruita","Verdures","Formatge",
    "Iogurt","CafÃ¨","Oli d'oliva","Peix","Carn","Suc de taronja","Cereals",
    "Galetes","SabÃ³ de mans","XampÃº","Detergent","Paper de vÃ ter",
    "Mantega","Pernil","TomÃ quets","Patates","Cebes","Alls","Llimones",
    "Maduixes","PlÃ tans","Pomes","Taronges","Enciam","Espinacs","CarbassÃ³",
    "Beixamel","Tonyina","Sardines","Olives","Vinagre","Mostassa",
    "Maionesa","Salsa de tomÃ quet","PatÃ© de cigrons","Mel","Melmelada","Mantega de cacauet",
    "Crispetes","Xocolata","Cacauets","Ametlles","Fruits secs","Patates fregides"
];

const QUANTITATS = [
    "2 unitats","3 unitats","Pack de 6","Pack familiar",
    "2 kg","1 caixa","3 ampolles","Oferta 2Ã—1","500 gr","1 litre","750 ml"
];

// â”€â”€â”€ ESTAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let estat = {niv:1, totalCorrecte:0, ratxa:0, jugant:false};
let stats = JSON.parse(localStorage.getItem('gobo26_mrc_stats')) || {ok:0,err:0,ratxa:0,total:0};
let recs  = JSON.parse(localStorage.getItem('gobo26_mrc_recs'))  || {};

actualitzarUI(); mostrarRecs();

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function barrejar(a){const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;}

// â”€â”€â”€ NAVEGACIÃ“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function iniciar(n){
    estat.niv=n; estat.ratxa=0; estat.jugant=false;
    document.getElementById('p-inici').style.display='none';
    document.getElementById('p-joc').style.display='block';
    document.getElementById('badge-niv').textContent=
        ['','ğŸ›’ Nivell 1','ğŸ§º Nivell 2','ğŸª Nivell 3','ğŸ¬ Nivell 4'][n];
    actualitzarBadges();
    novaRonda();
}

function tornar(){
    document.getElementById('p-joc').style.display='none';
    document.getElementById('p-inici').style.display='block';
    mostrarRecs();
    actualitzarUI();
}

// â”€â”€â”€ NOVA RONDA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function novaRonda(){
    estat.jugant=true;
    document.getElementById('btn-next').style.display='none';
    document.getElementById('missatge').innerHTML='';
    document.getElementById('missatge').style.color='';

    const cfg=CONFIG[estat.niv];
    let suma=0;
    const llista=document.getElementById('llista');
    llista.innerHTML='';
    const pool=barrejar([...PRODUCTES]);

    for(let i=0;i<cfg.items;i++){
        const preu=Math.floor(Math.random()*(cfg.maxP-cfg.minP+1))+cfg.minP;
        suma+=preu;
        const nom=pool[i];
        let det='';
        if(estat.niv>=3 && preu>8){
            det=QUANTITATS[Math.floor(Math.random()*QUANTITATS.length)];
        }
        const li=document.createElement('li');
        li.className='tiquet-item';
        li.innerHTML=`
            <div class="item-info">
                <span class="item-nom">${nom}</span>
                ${det?`<span class="item-det">${det}</span>`:''}
            </div>
            <span class="item-punts"></span>
            <span class="item-preu">${preu} â‚¬</span>`;
        llista.appendChild(li);
    }

    estat.totalCorrecte=suma;
    stats.total=(stats.total||0)+1;
    localStorage.setItem('gobo26_mrc_stats',JSON.stringify(stats));

    // RÃ¨cord per nivell (rondes jugades)
    const k=`n${estat.niv}`;
    if(!recs[k]) recs[k]={rec:0,rondes:0};
    recs[k].rondes=(recs[k].rondes||0)+1;
    localStorage.setItem('gobo26_mrc_recs',JSON.stringify(recs));

    generarOpcions(suma);
    actualitzarUI();
}

// â”€â”€â”€ OPCIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generarOpcions(correcte){
    const cont=document.getElementById('opcions');
    cont.innerHTML='';
    const digitBo=correcte%10;
    let digitDolent=(digitBo+Math.floor(Math.random()*4)+1)%10;

    let opcions=[correcte];
    // 2 mÃ©s amb el mateix dÃ­git bo
    let it=0;
    while(opcions.length<3&&it<200){
        it++;
        const salt=(Math.floor(Math.random()*5)+1)*10*(Math.random()>.5?1:-1);
        const c=correcte+salt;
        if(c>0&&!opcions.includes(c)) opcions.push(c);
    }
    while(opcions.length<3) opcions.push(correcte+(opcions.length*10));
    // 3 amb dÃ­git diferent
    it=0;
    while(opcions.length<6&&it<200){
        it++;
        const base=correcte+(Math.floor(Math.random()*40)-20);
        const c=Math.floor(base/10)*10+digitDolent;
        if(c>0&&!opcions.includes(c)) opcions.push(c);
    }
    while(opcions.length<6) opcions.push(correcte+100+opcions.length);

    barrejar(opcions).forEach(val=>{
        const btn=document.createElement('button');
        btn.className='btn-op';
        btn.textContent=val+' â‚¬';
        btn.onclick=()=>verificar(btn,val);
        cont.appendChild(btn);
    });
}

// â”€â”€â”€ VERIFICAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function verificar(btn,valor){
    if(!estat.jugant) return;
    estat.jugant=false;
    sonarClic();

    const tots=document.querySelectorAll('.btn-op');
    tots.forEach(b=>b.classList.add('desactivat'));
    tots.forEach(b=>b.disabled=true);

    const mis=document.getElementById('missatge');

    if(valor===estat.totalCorrecte){
        btn.classList.add('correcte');
        sonarWin();
        llenÃ§arConfeti();
        vibrar([60,30,120]);
        estat.ratxa++;
        stats.ok=(stats.ok||0)+1;
        if(estat.ratxa>stats.ratxa) stats.ratxa=estat.ratxa;
        // RÃ¨cord per nivell
        const k=`n${estat.niv}`;
        if(!recs[k]) recs[k]={rec:0,rondes:0};
        if(estat.ratxa>recs[k].rec) recs[k].rec=estat.ratxa;
        localStorage.setItem('gobo26_mrc_recs',JSON.stringify(recs));
        mis.style.color='var(--ok)';
        const msg=estat.ratxa===1?'âœ… Correcte!':estat.ratxa>=5?`ğŸ”¥ ${estat.ratxa} de ratxa!`:`âœ… Correcte! Ratxa: ${estat.ratxa}`;
        mis.textContent=msg;
    } else {
        btn.classList.add('incorrecte');
        sonarErr();
        vibrar([100,50,200]);
        // Mostrar la correcta
        tots.forEach(b=>{if(parseInt(b.textContent)===estat.totalCorrecte) b.classList.add('correcte');});
        estat.ratxa=0;
        stats.err=(stats.err||0)+1;
        mis.style.color='var(--err)';
        mis.textContent=`âŒ Era ${estat.totalCorrecte} â‚¬`;
    }

    localStorage.setItem('gobo26_mrc_stats',JSON.stringify(stats));
    actualitzarBadges();
    actualitzarUI();
    mostrarRecs();
    document.getElementById('btn-next').style.display='block';
}

// â”€â”€â”€ UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function actualitzarBadges(){
    document.getElementById('badge-ratxa').textContent=`ğŸ¯ Ratxa: ${estat.ratxa}`;
    document.getElementById('badge-ratxa').className='badge '+(estat.ratxa>=5?'gold':estat.ratxa>0?'bo':'');
    const k=`n${estat.niv}`;
    const rec=recs[k]?.rec||0;
    document.getElementById('badge-rec').textContent=`ğŸ† RÃ¨cord: ${rec||'â€”'}`;
}

function actualitzarUI(){
    document.getElementById('st-ok').textContent=stats.ok||0;
    document.getElementById('st-err').textContent=stats.err||0;
    document.getElementById('st-ratxa').textContent=stats.ratxa||0;
    document.getElementById('st-total').textContent=stats.total||0;
    document.getElementById('estadistiques').style.display=(stats.total>0)?'block':'none';
    // Recs a la pantalla inici
    [1,2,3,4].forEach(n=>{
        const k=`n${n}`;
        const r=recs[k]?.rec||0;
        document.getElementById(`rec-${n}`).textContent=r>0?r:'â€”';
    });
}

function mostrarRecs(){
    let te=false;
    [1,2,3,4].forEach(n=>{
        const k=`n${n}`;
        const r=recs[k];
        const row=document.getElementById(`rec-row-${n}`);
        if(r&&r.rondes>0){
            document.getElementById(`recp-${n}`).textContent=r.rec||0;
            document.getElementById(`rondes-${n}`).textContent=r.rondes||0;
            if(row) row.style.display='';
            te=true;
        } else if(row) row.style.display='none';
    });
    document.getElementById('record-panel').style.display=te?'block':'none';
}

function esborrarDades(){
    if(!confirm('Voleu esborrar totes les dades?')) return;
    stats={ok:0,err:0,ratxa:0,total:0};recs={};
    localStorage.removeItem('gobo26_mrc_stats');localStorage.removeItem('gobo26_mrc_recs');
    actualitzarUI();mostrarRecs();
}

// â”€â”€â”€ AJUDA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mostrarAjuda(){document.getElementById('modal-ajuda').classList.add('show');}
function tancarAjuda() {document.getElementById('modal-ajuda').classList.remove('show');}

// â”€â”€â”€ SO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let actx;
function ga(){if(!actx)actx=new(window.AudioContext||window.webkitAudioContext)();return actx;}
function sonarClic(){try{const c=ga(),o=c.createOscillator(),g=c.createGain();o.connect(g);g.connect(c.destination);o.frequency.value=400;g.gain.setValueAtTime(.04,c.currentTime);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.08);o.start();o.stop(c.currentTime+.08);}catch(e){}}
function sonarErr(){try{const c=ga(),o=c.createOscillator(),g=c.createGain();o.type='square';o.connect(g);g.connect(c.destination);o.frequency.setValueAtTime(200,c.currentTime);o.frequency.exponentialRampToValueAtTime(60,c.currentTime+.2);g.gain.setValueAtTime(.1,c.currentTime);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.25);o.start();o.stop(c.currentTime+.25);}catch(e){}}
function sonarWin(){try{const c=ga();[[523,.12],[659,.12],[784,.12],[1047,.35]].forEach(([f,d],i)=>{const o=c.createOscillator(),g=c.createGain();o.connect(g);g.connect(c.destination);o.frequency.value=f;const t=c.currentTime+i*.14;g.gain.setValueAtTime(.08,t);g.gain.exponentialRampToValueAtTime(.001,t+d);o.start(t);o.stop(t+d);});}catch(e){}}

// â”€â”€â”€ CONFETI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function llenÃ§arConfeti(){
    const cs=['#2563eb','#f59e0b','#16a34a','#dc2626','#8b5cf6','#ec4899'];
    for(let i=0;i<60;i++) setTimeout(()=>{
        const e=document.createElement('div');e.className='confeti';
        e.style.left=Math.random()*100+'vw';e.style.top='-10px';
        e.style.background=cs[Math.floor(Math.random()*cs.length)];
        e.style.animationDuration=(1.4+Math.random()*1.8)+'s';
        const s=(5+Math.random()*7)+'px';e.style.width=s;e.style.height=s;
        document.body.appendChild(e);setTimeout(()=>e.remove(),3500);
    },i*28);
}

function vibrar(p){if(navigator.vibrate)navigator.vibrate(p);}
</script>
</body>
</html>
