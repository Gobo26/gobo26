<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Pinta Paraules Â· Gobo26</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Black+Han+Sans&display=swap" rel="stylesheet">
<style>
:root {
    --bg:#f1f5f9; --s200:#e2e8f0; --s300:#cbd5e1; --s400:#94a3b8;
    --s600:#475569; --s700:#334155; --s800:#1e293b;
    --blue:#2563eb; --blue2:#3b82f6;
    --ok:#16a34a; --okl:#dcfce7;
    --err:#dc2626; --errl:#fee2e2;
    --gold:#f59e0b;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Montserrat',sans-serif;background:var(--bg);min-height:100vh;display:flex;flex-direction:column;align-items:center;overflow-x:hidden;}

/* HEADER */
.top-header{width:100%;background:var(--s800);padding:10px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
.logo{display:flex;align-items:center;gap:8px;text-decoration:none;opacity:0.6;transition:opacity .2s;}
.logo:hover{opacity:1;}
@media(max-width:420px){.logo{display:none;}}
.hdr-title{font-size:1rem;font-weight:900;color:white;letter-spacing:.5px;flex:1;text-align:center;}
.btn-hdr{font-family:'Montserrat',sans-serif;font-size:1rem;font-weight:900;width:36px;height:36px;border-radius:50%;border:2px solid var(--s600);background:var(--s700);color:white;cursor:pointer;transition:background .2s;flex-shrink:0;}
.btn-hdr:hover{background:var(--blue);}
.btn-hdr.btn-abandon:hover{background:var(--err);}
.btn-abandon-vis{font-family:'Montserrat',sans-serif;font-size:.72rem;font-weight:800;
    background:#dc2626;color:white;border:none;border-radius:8px;
    padding:6px 10px;cursor:pointer;letter-spacing:.04em;
    transition:background .2s,transform .1s;flex-shrink:0;}
.btn-abandon-vis:hover{background:#b91c1c;transform:scale(1.05);}
.btn-abandon-vis:active{transform:scale(.97);}

main{width:100%;max-width:700px;padding:16px 12px 32px;display:flex;flex-direction:column;align-items:center;gap:14px;}

/* MARCADORS */
.marcadors{display:flex;gap:8px;width:100%;justify-content:center;flex-wrap:wrap;}
.xip{background:white;border-radius:12px;padding:10px 16px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.08);min-width:80px;flex:1;}
.xip .val{font-size:1.4rem;font-weight:900;color:var(--s800);}
.xip .lab{font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--s400);margin-top:2px;}
.xip.gold .val{color:var(--gold);}
.xip.blue .val{color:var(--blue);}
.xip.ok .val{color:var(--ok);}

/* ZONA JOC */
.zona-joc{width:100%;display:grid;grid-template-columns:1fr 1fr;gap:12px;}
@media(max-width:480px){.zona-joc{grid-template-columns:1fr 1fr;gap:8px;}}

/* PARAULES */
.columna-paraules{display:flex;flex-direction:column;gap:8px;}
.btn-paraula{
    font-family:'Black Han Sans',sans-serif;
    background:white;border:3px solid var(--s200);border-radius:12px;
    padding:10px 6px;font-weight:400;font-size:2.2rem;letter-spacing:.02em;cursor:pointer;
    text-align:center;transition:transform .15s,border-color .15s,box-shadow .15s;
    box-shadow:0 2px 6px rgba(0,0,0,.07);line-height:1.1;
    width:100%;
}
.btn-paraula:hover:not(:disabled){border-color:var(--blue2);transform:translateY(-2px);box-shadow:0 4px 12px rgba(37,99,235,.2);}
.btn-paraula.seleccionat{outline:4px solid var(--blue)!important;outline-offset:2px;transform:scale(1.04);box-shadow:0 0 0 6px rgba(37,99,235,.25)!important;}
.btn-paraula.correcte{border-color:var(--ok)!important;background:var(--okl)!important;opacity:.5;cursor:default;pointer-events:none;}
.btn-paraula.error-flash{border-color:var(--err)!important;animation:flash .5s;}
@keyframes flash{0%,100%{background:white}50%{background:var(--errl)}}

/* POTS */
.columna-pots{display:grid;grid-template-columns:1fr 1fr;gap:8px;align-content:start;}
.pot{
    border-radius:14px;cursor:pointer;
    display:flex;flex-direction:column;justify-content:flex-end;align-items:center;
    padding-bottom:10px;padding-top:10px;
    box-shadow:0 4px 0 rgba(0,0,0,.15);
    border:3px solid rgba(255,255,255,.3);
    transition:transform .15s,box-shadow .15s;
    min-height:80px;position:relative;overflow:hidden;
}
.pot::before{content:'';position:absolute;top:6px;left:50%;transform:translateX(-50%);width:55%;height:8px;background:rgba(255,255,255,.3);border-radius:99px;}
.pot:hover{transform:translateY(-3px);box-shadow:0 7px 0 rgba(0,0,0,.12);}
.pot:active{transform:translateY(2px);box-shadow:0 2px 0 rgba(0,0,0,.15);}

.pot-label{background:rgba(255,255,255,.85);padding:3px 10px;border-radius:99px;font-size:.68rem;font-weight:800;text-transform:uppercase;letter-spacing:.06em;color:#1e293b;}

/* MISSATGE FEEDBACK */
#feedback{min-height:28px;text-align:center;font-weight:700;font-size:.95rem;color:var(--s700);transition:color .2s;}

/* INSTRUCCIONS */
.instruccions{width:100%;background:white;border-radius:14px;padding:14px 16px;box-shadow:0 2px 8px rgba(0,0,0,.08);border-left:4px solid var(--blue);}
.instruccions p{font-size:.82rem;color:var(--s600);line-height:1.6;}
.instruccions strong{color:var(--s800);}

/* RÃˆCORDS PLEGABLES */
.panel-recs{width:100%;background:white;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.08);overflow:hidden;}
.panel-cap{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;}
.panel-cap h3{font-size:.8rem;font-weight:700;color:var(--s700);text-transform:uppercase;letter-spacing:.1em;}
.rec-fila{display:flex;align-items:center;justify-content:space-around;padding:10px 16px 14px;gap:8px;}
.rec-bloc{display:flex;flex-direction:column;align-items:center;gap:2px;}
.rec-bloc .rv{font-size:1.3rem;font-weight:900;color:var(--blue);}
.rec-bloc .rl{font-size:.62rem;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--s400);}
.rec-sep{width:1px;height:36px;background:var(--s200);}
.rec-buida{padding:16px;text-align:center;color:var(--s400);font-size:.82rem;}
.btn-esborrar{font-family:'Montserrat',sans-serif;font-size:.68rem;color:var(--err);background:none;border:none;cursor:pointer;padding:4px 16px 10px;text-decoration:underline;display:block;margin:0 auto;}

/* OVERLAY FINAL */
#pantalla-inici{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;z-index:150;}
#pantalla-inici.ocult{display:none;}
#inici-titol{font-family:'Black Han Sans',sans-serif;font-size:2.8rem;color:var(--s800);text-align:center;letter-spacing:.05em;}
#inici-sub{font-size:.95rem;color:var(--s600);text-align:center;line-height:1.6;max-width:300px;}
#btn-preparats{font-family:'Montserrat',sans-serif;font-size:1.2rem;font-weight:900;background:var(--blue);color:white;border:none;border-radius:16px;padding:18px 40px;cursor:pointer;box-shadow:0 6px 0 #1d4ed8;transition:transform .1s,box-shadow .1s;letter-spacing:.04em;}
#btn-preparats:active{transform:translateY(3px);box-shadow:0 3px 0 #1d4ed8;}
#compte-enrere{font-family:'Black Han Sans',sans-serif;font-size:6rem;color:var(--blue);display:none;animation:puls .9s ease-in-out infinite;}
@keyframes puls{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:200;opacity:0;pointer-events:none;transition:opacity .3s;}
#overlay.vis{opacity:1;pointer-events:all;}
.modal{background:white;border-radius:24px;padding:32px 24px;text-align:center;max-width:340px;width:92%;transform:scale(.85);transition:transform .3s cubic-bezier(.34,1.56,.64,1);box-shadow:0 20px 60px rgba(0,0,0,.25);}
#overlay.vis .modal{transform:scale(1);}
.modal-emoji{font-size:3rem;margin-bottom:8px;}
.modal-titol{font-size:1.4rem;font-weight:900;color:var(--s800);margin-bottom:6px;}
.modal-text{color:var(--s600);font-size:.9rem;line-height:1.6;margin-bottom:20px;}
.modal-rec{font-size:1rem;font-weight:700;color:var(--gold);margin-bottom:16px;}
.btn-modal{font-family:'Montserrat',sans-serif;background:var(--blue);color:white;border:none;border-radius:12px;padding:14px 28px;font-size:1rem;font-weight:800;cursor:pointer;width:100%;box-shadow:0 4px 0 #1d4ed8;transition:opacity .2s;}
.btn-modal:hover{opacity:.9;}

/* OVERLAY AJUDA */
#overlay-ajuda{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:300;opacity:0;pointer-events:none;transition:opacity .25s;}
#overlay-ajuda.vis{opacity:1;pointer-events:all;}
.modal-ajuda{background:white;border-radius:20px;padding:24px;max-width:360px;width:92%;transform:scale(.9);transition:transform .3s cubic-bezier(.34,1.56,.64,1);box-shadow:0 20px 60px rgba(0,0,0,.3);max-height:90vh;overflow-y:auto;}
#overlay-ajuda.vis .modal-ajuda{transform:scale(1);}
.ajuda-titol{font-size:1.1rem;font-weight:900;color:var(--s800);margin-bottom:14px;text-align:center;}
.ajuda-pas{display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;}
.ajuda-ico{font-size:1.3rem;flex-shrink:0;width:26px;text-align:center;}
.ajuda-txt{font-size:.83rem;color:var(--s600);line-height:1.45;}
.ajuda-txt strong{color:var(--s800);}
.btn-tancar{font-family:'Montserrat',sans-serif;background:var(--s800);color:white;border:none;border-radius:10px;padding:12px;width:100%;font-weight:800;cursor:pointer;margin-top:10px;font-size:.9rem;}

/* CONFETI */
.confeti-p{position:fixed;top:-10px;width:9px;height:9px;border-radius:2px;pointer-events:none;z-index:400;animation:caure var(--dur) ease-in forwards;}
@keyframes caure{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(110vh) rotate(720deg);opacity:0}}

/* FOOTER */
footer{margin-top:auto;padding:14px;text-align:center;}

@media(max-width:400px){
    .btn-paraula{font-size:1.1rem;padding:11px 6px;}
    .pot{min-height:68px;}
    .xip .val{font-size:1.2rem;}
}

/* HEADER */
header{width:100%;background:#1e293b;border-bottom:1px solid #334155;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
.logo{display:flex;align-items:center;gap:8px;text-decoration:none;}
.logo-txt{font-size:1rem;font-weight:900;color:white;letter-spacing:-0.5px;}
.logo-txt span{color:#3b82f6;}
.hdr-title{font-size:.95rem;font-weight:700;color:white;letter-spacing:.5px;}
</style>
</head>
<body>

<header>
    <a href="https://ja.cat/appgobo" class="logo">
        <svg width="38" height="38" viewBox="0 0 40 40" fill="none">
            <polygon points="20,2 36,11 36,29 20,38 4,29 4,11" fill="#1e293b" stroke="#3b82f6" stroke-width="2"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="white" font-family="Montserrat,sans-serif" font-size="8" font-weight="900">GOBO</text>
            <text x="50%" y="72%" dominant-baseline="middle" text-anchor="middle" fill="#3b82f6" font-family="Montserrat,sans-serif" font-size="7" font-weight="900">26</text>
        </svg>
        <span class="logo-txt">GOBO<span>26</span></span>
    </a>
    <span class="hdr-title">Pinta Paraules</span>
</header>

<div id="pantalla-inici">
    <div id="inici-titol">ğŸ¨ PINTA<br>PARAULES</div>
    <div id="inici-sub">Clica el color de la <strong>tinta</strong> amb la qual estÃ  escrita cada paraula.<br>Ignora el que diu!</div>
    <button id="btn-preparats" onclick="comencarComptaEnrere()">ESTIC PREPARAT!</button>
    <div id="compte-enrere"></div>
</div>

<main>
    <!-- MARCADORS -->
    <div class="marcadors">
        <div class="xip blue"><div class="val" id="xip-pantalla">1</div><div class="lab">Pantalla</div></div>
        <div class="xip ok"><div class="val" id="xip-punts">0</div><div class="lab">Punts</div></div>
        <div class="xip gold"><div class="val" id="xip-rec">â€”</div><div class="lab">MÃ x. pantalla</div></div>
        <div class="xip"><div class="val" id="xip-ratxa">0</div><div class="lab">Ratxa</div></div>
    </div>

    <!-- BARRA COMPTE ENRERE + INTENTS -->
    <div style="width:100%;display:flex;align-items:center;gap:10px;">
        <div style="flex:1;background:#e2e8f0;border-radius:99px;height:12px;overflow:hidden;">
            <div id="barra-temps" style="height:100%;width:100%;background:#22c55e;border-radius:99px;transition:width 1s linear,background .5s;"></div>
        </div>
        <span style="font-size:.75rem;font-weight:900;color:#334155;white-space:nowrap;min-width:24px;text-align:right;" id="xip-ronda">8s</span>
    </div>
    <div style="width:100%;display:flex;justify-content:space-between;margin-top:-6px;padding:0 2px;">
        <span style="font-size:.65rem;font-weight:700;color:#94a3b8;">Errors: <span id="xip-intents">0/2</span></span>
        <span style="font-size:.65rem;font-weight:700;color:#94a3b8;">Temps per pantalla</span>
    </div>

    <!-- FEEDBACK -->
    <div id="feedback">Clica una paraula i desprÃ©s el seu pot de color real</div>

    <!-- ZONA JOC -->
    <div class="zona-joc">
        <div class="columna-paraules" id="col-paraules"></div>
        <div class="columna-pots" id="col-pots"></div>
    </div>

    <!-- RÃˆCORDS PLEGABLES -->
    <div class="panel-recs">
        <div class="panel-cap">
            <h3>ğŸ† Millor jugada</h3>
        </div>
        <div id="taula-recs"></div>
        <button class="btn-esborrar" onclick="esborrarRecs()">Esborrar dades</button>
    </div>
</main>

<!-- OVERLAY RESULTAT FINAL -->
<div id="overlay">
    <div class="modal">
        <div class="modal-emoji" id="m-emoji">ğŸ‰</div>
        <div class="modal-titol" id="m-titol">Completat!</div>
        <div class="modal-text" id="m-text"></div>
        <div class="modal-rec" id="m-rec"></div>
        <button class="btn-modal" onclick="iniciar()">Torna a jugar ğŸ¨</button>
    </div>
</div>

<!-- OVERLAY AJUDA -->
<div id="overlay-ajuda" onclick="tancarAjuda()">
    <div class="modal-ajuda" onclick="event.stopPropagation()">
        <div class="ajuda-titol">ğŸ¨ Com es juga?</div>
        <div class="ajuda-pas"><div class="ajuda-ico">ğŸ§ </div><div class="ajuda-txt"><strong>L'efecte Stroop:</strong> cada paraula estÃ  escrita en un color diferent del que diu. El teu cervell ha d'ignorar el significat i fixar-se en el color de la tinta.</div></div>
        <div class="ajuda-pas"><div class="ajuda-ico">ğŸ‘†</div><div class="ajuda-txt"><strong>Com jugar:</strong> clica una paraula de l'esquerra i desprÃ©s el pot del color <em>de la tinta</em>. Si diu <em>VERMELL</em> escrit en blau, clica el pot <strong>blau</strong>.</div></div>
        <div class="ajuda-pas"><div class="ajuda-ico">ğŸ¯</div><div class="ajuda-txt"><strong>L'objectiu:</strong> fer les 6 parelles correctes abans que s'acabi el compte enrere.</div></div>
        <div class="ajuda-pas"><div class="ajuda-ico">â±ï¸</div><div class="ajuda-txt"><strong>Temps per pantalla:</strong> comences amb <strong>24 segons</strong>. Cada pantalla superada redueix el temps: 24 â†’ 22 â†’ 20 â†’ 18 â†’ 16 â†’ 14 â†’ 13 â†’ 12 â†’ 11 â†’ 10 â†’ 8s.</div></div>
        <div class="ajuda-pas"><div class="ajuda-ico">ğŸ”„</div><div class="ajuda-txt"><strong>Temps esgotat:</strong> les paraules i colors es barregen de nou i ho tornes a intentar. Tens fins a <strong>3 intents</strong> per pantalla.</div></div>
        <div class="ajuda-pas"><div class="ajuda-ico">ğŸ’”</div><div class="ajuda-txt"><strong>3 intents fallats:</strong> tornes a la pantalla 1 amb 24 segons. Es guarda la pantalla mÃ xima assolida com a rÃ¨cord.</div></div>
        <div class="ajuda-pas"><div class="ajuda-ico">ğŸ”¥</div><div class="ajuda-txt"><strong>PuntuaciÃ³:</strong> +10 per encert, -5 per error. Cada 3 encerts seguits +5 bonus. Cada pantalla superada +20 extra.</div></div>
        <button class="btn-tancar" onclick="tancarAjuda()">Entesos! A jugar ğŸ®</button>
    </div>
</div>

<footer style="font-size:.72rem;color:#94a3b8;font-weight:600;text-align:center;padding:16px;margin-top:auto;border-top:1px solid #1e2d45;">
    <a href="https://ja.cat/appgobo"
       style="display:inline-flex;align-items:center;gap:6px;opacity:0.4;transition:opacity 0.2s;color:#94a3b8;text-decoration:none;"
       onmouseover="this.style.opacity=0.8" onmouseout="this.style.opacity=0.4">
        <svg width="13" height="13" viewBox="0 0 100 100" fill="none"><polygon points="50,2 93,26 93,74 50,98 7,74 7,26" fill="#94a3b8"/><text x="50" y="44" text-anchor="middle" fill="white" font-size="26" font-weight="800" font-family="sans-serif">G</text><text x="50" y="68" text-anchor="middle" fill="#1e293b" font-size="22" font-weight="700" font-family="sans-serif">26</text></svg>
        Una aplicaciÃ³ de Gobo26
    </a>
</footer>

<script>
// â”€â”€ DADES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COLORS = [
    { nom:'VERMELL', hex:'#ef4444' },
    { nom:'BLAU',    hex:'#3b82f6' },
    { nom:'VERD',    hex:'#22c55e' },
    { nom:'GROC',    hex:'#eab308' },
    { nom:'TARONJA', hex:'#f97316' },
    { nom:'LILA',    hex:'#a855f7' },
];

const SEQUENCIA_TEMPS = [24,22,20,18,16,14,13,12,11,10,8];
const TEMPS_INICI = SEQUENCIA_TEMPS[0];
const TEMPS_MINIM = 8;
const MAX_INTENTS = 3;
const MAX_FALLOS = 2;

// â”€â”€ ESTAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let seleccionada = null;
let encertsRonda = 0;
let punts = 0;
let ratxa = 0;
let pantalla = 1;
let intents = 0;
let fallos = 0;
let limitTemps = TEMPS_INICI;
let tempsRestant = TEMPS_INICI;
let intervalRonda = null;
let recs = JSON.parse(localStorage.getItem('gobo26_pinta_recs') || '[]');

// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function barrejar(a){ const b=[...a]; for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];} return b; }

function hexFosc(hex){
    const r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16);
    return (r*0.299+g*0.587+b*0.114) < 140;
}

// â”€â”€ Ã€UDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let actx;
function ga(){ if(!actx) actx=new(window.AudioContext||window.webkitAudioContext)(); return actx; }
function so(f,t,d,vol=0.018){ try{ const c=ga(),o=c.createOscillator(),g=c.createGain(); o.connect(g);g.connect(c.destination); o.type=t;o.frequency.value=f; g.gain.setValueAtTime(vol,c.currentTime); g.gain.exponentialRampToValueAtTime(.001,c.currentTime+d); o.start();o.stop(c.currentTime+d); }catch(e){} }
const soClick  = ()=>so(500,'sine',.1,.05);
const soOk     = ()=>{ so(523,'sine',.12); setTimeout(()=>so(659,'sine',.12),100); setTimeout(()=>so(784,'sine',.2),200); };
const soErr    = ()=>{ so(220,'sawtooth',.25); setTimeout(()=>so(180,'sawtooth',.3),130); };
const soUrgent = ()=>so(660,'sine',.08,.02);
const soBonus  = ()=>{ [523,659,784,1047].forEach((f,i)=>setTimeout(()=>so(f,'sine',.18),i*80)); };
const soKo     = ()=>so(260,'sine',.3,.025);
function vibrar(p){ if(navigator.vibrate) navigator.vibrate(p); }

// â”€â”€ CONFETI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function confeti(n=50){
    const cs=['#ef4444','#3b82f6','#22c55e','#eab308','#f97316','#a855f7','#ec4899'];
    for(let i=0;i<n;i++) setTimeout(()=>{
        const e=document.createElement('div'); e.className='confeti-p';
        e.style.left=Math.random()*100+'vw';
        e.style.backgroundColor=cs[Math.floor(Math.random()*cs.length)];
        e.style.setProperty('--dur',(1.3+Math.random()*1.5)+'s');
        e.style.animationDelay=Math.random()*.5+'s';
        document.body.appendChild(e); setTimeout(()=>e.remove(),3000);
    },i*25);
}

// â”€â”€ INICIAR (des de zero) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function iniciar(){
    punts=0; ratxa=0; pantalla=1; intents=0; fallos=0;
    limitTemps=TEMPS_INICI;
    document.getElementById('overlay').classList.remove('vis');
    document.getElementById('pantalla-inici').classList.remove('ocult');
    document.getElementById('btn-preparats').style.display='';
    document.getElementById('compte-enrere').style.display='none';
    actualitzarMarcadors();
    mostrarRecs();
}

function comencarComptaEnrere(){
    document.getElementById('btn-preparats').style.display='none';
    const ce=document.getElementById('compte-enrere');
    ce.style.display='block';
    let n=3;
    ce.textContent=n;
    so(440,'sine',.15,.06);
    const t=setInterval(()=>{
        n--;
        if(n>0){
            ce.textContent=n;
            so(440,'sine',.15,.06);
        } else {
            clearInterval(t);
            ce.textContent='';
            so(880,'sine',.3,.08);
            document.getElementById('pantalla-inici').classList.add('ocult');
            novaPartida();
        }
    },1000);
}

// â”€â”€ NOVA PANTALLA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function novaPartida(){
    seleccionada=null; encertsRonda=0; fallos=0;
    clearInterval(intervalRonda);
    tempsRestant=limitTemps;
    actualitzarBarra();
    generarJoc();
    actualitzarMarcadors();
    setFeedback('Troba les 6 parelles dins el temps!','');
    iniciarComptaEnrere();
}

// â”€â”€ COMPTE ENRERE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function iniciarComptaEnrere(){
    clearInterval(intervalRonda);
    intervalRonda = setInterval(()=>{
        tempsRestant--;
        actualitzarBarra();
        if(tempsRestant<=3 && tempsRestant>0) soUrgent();
        if(tempsRestant<=0){
            clearInterval(intervalRonda);
            tempsEsgotat();
        }
    },1000);
}

function actualitzarBarra(){
    const pct=Math.max(0, tempsRestant/limitTemps*100);
    const barra=document.getElementById('barra-temps');
    barra.style.width=pct+'%';
    barra.style.background=pct>60?'#22c55e':pct>30?'#eab308':'#ef4444';
    document.getElementById('xip-ronda').textContent=Math.max(0,tempsRestant)+'s';
}

// â”€â”€ TEMPS ESGOTAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tempsEsgotat(){
    soKo(); vibrar([200,100,200]);
    ratxa=0;
    actualitzarMarcadors();
    setFeedback('â±ï¸ Temps esgotat! Tornem a l\'inici...','#dc2626');
    setTimeout(()=>iniciar(), 1800);
}

// â”€â”€ GENERAR JOC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generarJoc(){
    const colPar=document.getElementById('col-paraules');
    const colPot=document.getElementById('col-pots');
    colPar.innerHTML=''; colPot.innerHTML='';

    const paraules    =barrejar([...COLORS]);
    const tintesBrutes=barrejar([...COLORS]);
    const fonsColors  =barrejar([...COLORS]);
    const potsBarr    =barrejar([...COLORS]);

    // Quantes paraules poden tenir significat = significat segons pantalla
    const matchPermesos = pantalla <= 3 ? 3 : pantalla <= 6 ? 2 : 0;
    // A partir de pantalla 7, els NOMS de les paraules es poden repetir
    const nomesRepetits = pantalla >= 7;

    // Generar la llista de noms de paraules (repetibles o no)
    let llistaNoms;
    if(nomesRepetits){
        // Noms aleatoris amb possibles repeticions
        llistaNoms = Array.from({length:COLORS.length}, ()=>COLORS[Math.floor(Math.random()*COLORS.length)]);
    } else {
        llistaNoms = barrejar([...COLORS]);
    }

    // Decidir quines posicions tindran tinta=significat
    const idxMatch = new Set();
    const idxBarr = barrejar([...Array(COLORS.length).keys()]);
    for(let k=0; k<matchPermesos; k++) idxMatch.add(idxBarr[k]);

    llistaNoms.forEach((color,i)=>{
        let tinta, it=0;
        if(idxMatch.has(i)){
            // Tinta = significat (ajuda)
            tinta = color;
        } else {
            // Tinta diferent del significat
            tinta = tintesBrutes[i];
            while(tinta.nom===color.nom && it<20){ tinta=COLORS[Math.floor(Math.random()*COLORS.length)]; it++; }
        }
        let fons=fonsColors[i]; it=0;
        while((fons.nom===color.nom||fons.nom===tinta.nom) && it<30){ fons=COLORS[Math.floor(Math.random()*COLORS.length)]; it++; }

        const fosca=hexFosc(fons.hex);
        const btn=document.createElement('button');
        btn.className='btn-paraula';
        btn.textContent=color.nom;
        btn.style.color=tinta.hex;
        btn.dataset.nom=color.nom;
        btn.dataset.tinta=tinta.nom;
        btn.onclick=()=>seleccionarParaula(btn,color,tinta);
        colPar.appendChild(btn);
    });

    potsBarr.forEach(color=>{
        const pot=document.createElement('div');
        pot.className='pot';
        pot.style.backgroundColor=color.hex;
        pot.dataset.nom=color.nom;

        pot.onclick=()=>comprovar(color);
        colPot.appendChild(pot);
    });
}

// â”€â”€ SELECCIONAR PARAULA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function seleccionarParaula(btn,color,tinta){
    document.querySelectorAll('.btn-paraula:not(.correcte)').forEach(b=>b.classList.remove('seleccionat'));
    seleccionada={btn,color,tinta};
    btn.classList.add('seleccionat');
    setFeedback('"'+color.nom+'" seleccionada â€” clica el pot del color de la tinta!','#2563eb');
}

// â”€â”€ COMPROVAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function comprovar(colorPot){
    if(!seleccionada){
        setFeedback('âš ï¸ Primer selecciona una paraula!','#f97316');
        vibrar([80]); return;
    }

    if(seleccionada.tinta.nom===colorPot.nom){
        vibrar([40]);
        seleccionada.btn.classList.add('correcte');
        seleccionada.btn.classList.remove('seleccionat');


        encertsRonda++; ratxa++; punts+=10;

        let msg='âœ… Correcte! '+encertsRonda+'/6';
        if(ratxa>0&&ratxa%3===0){ punts+=5; soBonus(); msg='ğŸ”¥ Ratxa de '+ratxa+'! +5 bonus'; }

        seleccionada=null;
        actualitzarMarcadors();
        setFeedback(msg,'#16a34a');

        if(encertsRonda===COLORS.length){
            clearInterval(intervalRonda);
            setTimeout(pantallaCompletada, 500);
        }

    } else {
        soErr(); vibrar([100,50,150]);
        ratxa=0; fallos++; punts=Math.max(0,punts-5);
        seleccionada.btn.classList.add('error-flash');
        setTimeout(()=>{ if(seleccionada) seleccionada.btn.classList.remove('error-flash'); },500);
        actualitzarMarcadors();
        if(fallos>MAX_FALLOS){
            clearInterval(intervalRonda);
            setFeedback('ğŸ’” Massa errors! Tornem a l\'inici...','#dc2626');
            setTimeout(()=>iniciar(), 1800);
        } else {
            const msg2 = fallos>=MAX_FALLOS ? 'âš ï¸ Segon error! El proper acaba la jugada.' : 'âŒ Error 1/2! Tens un altre intent.';
            setFeedback(msg2,'#dc2626');
        }
    }
}

// â”€â”€ PANTALLA COMPLETADA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function pantallaCompletada(){
    soBonus(); confeti(50); vibrar([80,40,160]);
    // Desar rÃ¨cord: nomÃ©s si la pantalla actual supera la guardada
    const rec = recs[0] || null;
    if(!rec || pantalla > rec.pantalla || (pantalla === rec.pantalla && punts > rec.punts)){
        recs = [{pantalla, punts, data:new Date().toLocaleDateString('ca-ES')}];
        localStorage.setItem('gobo26_pinta_recs',JSON.stringify(recs));
    }

    pantalla++; intents=0;
    const idxActual = SEQUENCIA_TEMPS.indexOf(limitTemps);
limitTemps = idxActual >= 0 && idxActual < SEQUENCIA_TEMPS.length-1 ? SEQUENCIA_TEMPS[idxActual+1] : TEMPS_MINIM;
    punts+=20;
    actualitzarMarcadors();
    mostrarRecs();
    setFeedback('ğŸ‰ Pantalla '+(pantalla-1)+' superada! Ara: '+limitTemps+'s...','#16a34a');
    setTimeout(()=>novaPartida(), 1800);
}

// â”€â”€ UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function actualitzarMarcadors(){
    document.getElementById('xip-punts').textContent=punts;
    document.getElementById('xip-ratxa').textContent=ratxa;
    document.getElementById('xip-pantalla').textContent=pantalla;
    document.getElementById('xip-intents').textContent=fallos+'/'+MAX_FALLOS;
    const millor=recs.length>0?recs[0].pantalla:'â€”';
    document.getElementById('xip-rec').textContent=millor;
}

function setFeedback(txt,color){
    const el=document.getElementById('feedback');
    el.textContent=txt; el.style.color=color||'#334155';
}

// â”€â”€ RÃˆCORDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mostrarRecs(){
    const z=document.getElementById('taula-recs');
    const r=recs[0]||null;
    if(!r){ z.innerHTML='<div class="rec-buida">Encara no hi ha cap marca. Juga!</div>'; return; }
    z.innerHTML=`<div class="rec-fila">
        <div class="rec-bloc"><span class="rv">${r.pantalla}</span><span class="rl">Pantalla</span></div>
        <div class="rec-sep"></div>
        <div class="rec-bloc"><span class="rv">${r.punts}</span><span class="rl">Punts</span></div>
        <div class="rec-sep"></div>
        <div class="rec-bloc"><span class="rv" style="font-size:.9rem">${r.data}</span><span class="rl">Data</span></div>
    </div>`;
}

function esborrarRecs(){
    if(!confirm('Vols esborrar totes les marques?')) return;
    recs=[]; localStorage.removeItem('gobo26_pinta_recs');
    mostrarRecs(); actualitzarMarcadors();
}

function abandonar(){
    if(!confirm('Vols abandonar la partida?')) return;
    clearInterval(intervalRonda);
    // Desar rÃ¨cord de la pantalla assolida fins ara
    if(pantalla > 1){
        const entrada={pantalla:pantalla-1,punts,data:new Date().toLocaleDateString('ca-ES')};
        recs.push(entrada);
        recs.sort((a,b)=>b.pantalla-a.pantalla||b.punts-a.punts);
        if(recs.length>10) recs=recs.slice(0,10);
        localStorage.setItem('gobo26_pinta_recs',JSON.stringify(recs));
        mostrarRecs();
    }
    iniciar();
}

function obrirAjuda(){ document.getElementById('overlay-ajuda').classList.add('vis'); }
function tancarAjuda(){ document.getElementById('overlay-ajuda').classList.remove('vis'); }

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
mostrarRecs();
actualitzarMarcadors();
iniciar();
</script>
</body>
</html>