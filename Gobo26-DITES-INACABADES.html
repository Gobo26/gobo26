<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dites Inacabades ¬∑ Gobo26</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Lora:ital,wght@0,600;1,400;1,600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f1f5f9;--paper:#fffcf5;--paper2:#fff8e8;
  --ink:#2c1810;--ink2:#5c3d20;--ink3:#8b6340;
  --s200:#e8ddd0;--s300:#d4c4b0;--s400:#b09880;--s800:#1e293b;
  --blue:#2563eb;--blue2:#3b82f6;
  --ok:#16a34a;--okl:#f0fdf4;--okd:#166534;
  --err:#dc2626;--errl:#fff1f1;--errd:#991b1b;
  --gold:#b45309;--goldl:#fef9c3;--amber:#f59e0b;
  --sepia1:#8b6340;--sepia2:#d4a853;--sepia3:#f5e6c8;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;overflow:hidden;}
body{
  font-family:'Montserrat',sans-serif;
  background:var(--bg);
  background-image:repeating-linear-gradient(0deg,transparent,transparent 27px,rgba(180,140,80,.07) 28px);
  display:flex;flex-direction:column;align-items:center;
}

/* HEADER */
.top-header{
  width:100%;background:var(--s800);padding:10px 16px;
  display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;z-index:50;box-shadow:0 2px 12px rgba(0,0,0,.3);
  flex-shrink:0;
}
.logo{display:flex;align-items:center;gap:8px;text-decoration:none;}
.logo-txt{font-size:1rem;font-weight:900;color:white;}
.logo-txt span{color:var(--blue2);}
.hdr-title{font-family:'Lora',serif;font-size:1rem;font-weight:600;color:#f5e6c8;letter-spacing:.5px;}
#btn-ajuda{
  font-family:'Montserrat',sans-serif;font-size:1.1rem;font-weight:900;
  width:38px;height:38px;border-radius:50%;border:2px solid var(--blue2);
  background:var(--blue);color:white;cursor:pointer;transition:background .2s,transform .15s;
  flex-shrink:0;
}
#btn-ajuda:hover{background:var(--blue2);transform:scale(1.1);}

/* MAIN AREA ‚Äî scroll intern */
main{
  width:100%;max-width:660px;padding:14px 12px 10px;
  display:flex;flex-direction:column;align-items:center;gap:12px;
  flex:1;overflow-y:auto;
}

/* PANTALLA INICI */
.inici-card{
  width:100%;background:var(--paper);border-radius:4px;
  padding:22px 22px 18px;
  box-shadow:4px 4px 0 var(--s300),8px 8px 0 var(--s200),0 12px 30px rgba(0,0,0,.12);
  border:1px solid var(--s300);position:relative;overflow:hidden;
}
.inici-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:5px;
  background:repeating-linear-gradient(90deg,var(--sepia2) 0,var(--sepia2) 8px,transparent 8px,transparent 14px);
}
.inici-titol{font-family:'Lora',serif;font-size:1.6rem;font-weight:600;color:var(--ink);text-align:center;margin:10px 0 4px;}
.inici-sub{font-family:'Lora',serif;font-size:.88rem;font-style:italic;color:var(--ink3);text-align:center;margin-bottom:20px;}
.niv-llista{display:flex;flex-direction:column;gap:10px;}
.btn-niv{
  font-family:'Montserrat',sans-serif;background:var(--paper2);
  border:1.5px solid var(--s300);border-radius:4px;padding:14px 18px;
  width:100%;text-align:left;cursor:pointer;
  display:flex;justify-content:space-between;align-items:center;
  transition:all .15s;box-shadow:2px 2px 0 var(--s300);
  min-height:44px;
}
.btn-niv:hover{background:var(--sepia3);border-color:var(--sepia2);transform:translate(-2px,-2px);box-shadow:4px 4px 0 var(--s300);}
.btn-niv-nom{font-size:.95rem;font-weight:700;color:var(--ink);}
.btn-niv-desc{font-size:.72rem;color:var(--ink3);margin-top:2px;}
.btn-niv-fletxa{font-size:1.2rem;color:var(--sepia2);font-weight:900;}

/* PANTALLA JOC */
#p-joc{display:none;width:100%;}
.info-bar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:8px;}
.badge{
  font-size:.72rem;font-weight:700;padding:5px 12px;border-radius:2px;
  background:var(--paper);color:var(--ink2);border:1px solid var(--s300);
  box-shadow:1px 1px 0 var(--s300);
}
.badge.bo{background:var(--okl);color:var(--ok);border-color:#86efac;}

/* PERGAM√ç */
.pergami{
  width:100%;background:linear-gradient(160deg,#fffcf0,#fff8e0 60%,#fdf3d0);
  border:1.5px solid var(--sepia2);border-radius:4px;
  padding:20px 20px 16px;
  box-shadow:3px 3px 0 var(--s300),6px 6px 0 var(--s200),0 8px 24px rgba(0,0,0,.1);
  position:relative;margin-bottom:10px;
}
.pergami::before{
  content:'';position:absolute;top:6px;left:6px;right:6px;bottom:6px;
  border:1px solid rgba(180,140,80,.2);border-radius:2px;pointer-events:none;
}
.pergami-deco{text-align:center;font-size:1.4rem;margin-bottom:6px;opacity:.55;}
.instruccio-dita{
  font-size:.68rem;font-weight:700;color:var(--ink3);
  text-transform:uppercase;letter-spacing:2px;text-align:center;margin-bottom:12px;
}
.inici-dita{
  font-family:'Lora',serif;font-size:1.3rem;font-weight:600;
  color:var(--ink);line-height:1.5;text-align:center;
}
.punts-susp{color:var(--sepia2);letter-spacing:4px;font-style:italic;}

/* OPCIONS */
.opcions-grid{width:100%;display:grid;grid-template-columns:1fr;gap:9px;margin-bottom:10px;}
.btn-op{
  font-family:'Lora',serif;background:var(--paper);border:1.5px solid var(--s300);
  border-radius:4px;padding:13px 16px;font-size:.95rem;font-style:italic;
  color:var(--ink2);cursor:pointer;transition:all .15s;
  text-align:left;width:100%;box-shadow:2px 2px 0 var(--s300);
  line-height:1.45;min-height:44px;
}
.btn-op::before{content:'\2026\00a0';color:var(--sepia2);font-weight:700;font-style:normal;}
.btn-op:hover:not(:disabled){
  background:var(--sepia3);border-color:var(--sepia2);
  transform:translate(-2px,-2px);box-shadow:4px 4px 0 var(--s300);color:var(--ink);
}
.btn-op:active:not(:disabled){transform:none;box-shadow:0 0 0 var(--s300);}
.btn-op.encert{background:var(--okl)!important;border-color:var(--ok)!important;color:var(--okd)!important;box-shadow:2px 2px 0 var(--okd)!important;}
.btn-op.encert::before{content:'\2705\00a0';font-style:normal;}
.btn-op.error{background:var(--errl)!important;border-color:var(--err)!important;color:var(--errd)!important;box-shadow:2px 2px 0 var(--errd)!important;animation:shake .35s ease;}
.btn-op.error::before{content:'\274c\00a0';font-style:normal;}
.btn-op.revelat{background:var(--okl)!important;border-color:var(--ok)!important;color:var(--okd)!important;opacity:.8;box-shadow:none!important;}
.btn-op.revelat::before{content:'\2705\00a0';font-style:normal;}
.btn-op.broma-rev{background:#fef9c3!important;border-color:var(--amber)!important;color:#78350f!important;opacity:.8;box-shadow:none!important;}
.btn-op.broma-rev::before{content:'\1f0cf\00a0';font-style:normal;}

/* FEEDBACK */
.feedback-card{
  width:100%;background:var(--paper);border:1.5px solid var(--s300);
  border-radius:4px;padding:18px 20px;box-shadow:3px 3px 0 var(--s300);
  display:none;animation:slideUp .3s ease;
}
.fb-ico{font-size:2rem;text-align:center;margin-bottom:6px;}
.fb-titol{font-size:1rem;font-weight:900;text-align:center;margin-bottom:8px;}
.fb-refrany{
  font-family:'Lora',serif;font-size:.95rem;font-style:italic;color:var(--ink);
  text-align:center;background:linear-gradient(135deg,var(--sepia3),var(--goldl));
  border-radius:4px;border-left:3px solid var(--sepia2);
  padding:10px 14px;margin-bottom:10px;line-height:1.6;
}
.fb-desc{font-size:.8rem;color:var(--ink2);text-align:center;line-height:1.5;margin-bottom:12px;}
#btn-seg{
  font-family:'Montserrat',sans-serif;width:100%;padding:13px;
  background:var(--s800);color:#f5e6c8;border:none;border-radius:4px;
  font-size:.92rem;font-weight:900;cursor:pointer;
  box-shadow:3px 3px 0 var(--ink);letter-spacing:.5px;
  transition:all .1s;min-height:44px;
}
#btn-seg:hover{opacity:.9;}
#btn-seg:active{transform:translate(2px,2px);box-shadow:none;}

/* COMPTADOR RONDES */
.ronda-comptador{
  font-size:.75rem;font-weight:700;color:var(--ink3);
  text-align:center;padding:4px 0;
}

/* MODAL AJUDA */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:200;align-items:center;justify-content:center;}
.modal-overlay.show{display:flex;}
.modal-box{
  background:var(--paper);border:1.5px solid var(--s300);border-radius:4px;
  padding:26px 22px 20px;max-width:400px;width:92%;
  box-shadow:6px 6px 0 var(--s300),0 20px 60px rgba(0,0,0,.3);
  animation:popIn .3s ease;max-height:90vh;overflow-y:auto;
}
.modal-box h2{font-family:'Lora',serif;font-size:1.2rem;margin-bottom:14px;color:var(--ink);}
.ajuda-pas{display:flex;gap:10px;margin-bottom:10px;font-size:.84rem;line-height:1.55;color:var(--ink2);}
.ajuda-ico{font-size:1.25rem;flex-shrink:0;}
.ajuda-niv{
  background:var(--sepia3);border-radius:4px;border-left:3px solid var(--sepia2);
  padding:10px 12px;margin:8px 0 12px;font-size:.78rem;line-height:1.9;color:var(--ink2);
}
.ajuda-niv strong{color:var(--ink);}
#btn-tancar-ajuda{
  width:100%;font-family:'Montserrat',sans-serif;font-size:.88rem;font-weight:700;
  padding:12px;background:var(--s800);color:#f5e6c8;border:none;border-radius:4px;
  cursor:pointer;margin-top:8px;box-shadow:2px 2px 0 var(--ink);min-height:44px;
}

/* ANIMACIONS */
@keyframes popIn{from{transform:scale(.85) translateY(10px);opacity:0}to{transform:none;opacity:1}}
@keyframes slideUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
@keyframes floatUp{to{transform:translateY(-50px);opacity:0}}
.confeti{position:fixed;pointer-events:none;z-index:300;animation:confetti-fall 2.2s ease-in forwards;}
@keyframes confetti-fall{to{transform:translateY(110vh) rotate(540deg);opacity:0}}
.bonus-pop{position:fixed;font-family:'Montserrat',sans-serif;font-size:1.1rem;font-weight:900;pointer-events:none;z-index:100;animation:slideUp .2s ease,floatUp 1s .2s ease forwards;}

/* FOOTER */
footer{
  font-size:.72rem;color:var(--ink3);font-weight:600;
  text-align:center;padding:10px;flex-shrink:0;
}

/* RESPONSIVE */
@media(min-width:520px){.opcions-grid{grid-template-columns:1fr 1fr;}}
@media(max-width:400px){.inici-dita{font-size:1.1rem;}.logo-txt{display:none;}}
</style>
</head>
<body>
<header class="top-header">
  <a href="https://ja.cat/gobo26" target="_blank" class="logo">
    <svg width="38" height="38" viewBox="0 0 40 40" fill="none">
      <polygon points="20,2 36,11 36,29 20,38 4,29 4,11" fill="#1e293b" stroke="#3b82f6" stroke-width="2"/>
      <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="white" font-family="Montserrat,sans-serif" font-size="8" font-weight="900">GOBO</text>
      <text x="50%" y="72%" dominant-baseline="middle" text-anchor="middle" fill="#3b82f6" font-family="Montserrat,sans-serif" font-size="7" font-weight="900">26</text>
    </svg>
    <span class="logo-txt">GOBO<span>26</span></span>
  </a>
  <span class="hdr-title">Dites Inacabades</span>
  <button id="btn-ajuda" onclick="mostrarAjuda()">?</button>
</header>

<main id="main-area">

<!-- PANTALLA INICI -->
<div class="inici-card" id="p-inici">
  <div class="inici-titol">Dites Inacabades</div>
  <div class="inici-sub">Com acaba aquesta dita popular?</div>
  <div class="niv-llista">
    <button class="btn-niv" onclick="iniciar(1)">
      <div>
        <div class="btn-niv-nom">üåø Nivell 1 ¬∑ Populars</div>
        <div class="btn-niv-desc">Dites que tothom hauria de con√®ixer</div>
      </div>
      <span class="btn-niv-fletxa">‚ñ∂</span>
    </button>
    <button class="btn-niv" onclick="iniciar(2)">
      <div>
        <div class="btn-niv-nom">ü¶â Nivell 2 ¬∑ Per pensar-hi</div>
        <div class="btn-niv-desc">Menys habituals, cal reflexionar</div>
      </div>
      <span class="btn-niv-fletxa">‚ñ∂</span>
    </button>
    <button class="btn-niv" onclick="iniciar(3)">
      <div>
        <div class="btn-niv-nom">üßì Nivell 3 ¬∑ Dels avis</div>
        <div class="btn-niv-desc">Les dites m√©s antigues i picants</div>
      </div>
      <span class="btn-niv-fletxa">‚ñ∂</span>
    </button>
  </div>
</div>

<!-- PANTALLA JOC -->
<div id="p-joc">
  <div class="info-bar">
    <span class="badge" id="badge-niv">Nivell 1</span>
    <span class="badge bo" id="badge-ratxa">üéØ Ratxa: 0</span>
  </div>
  <div class="pergami">
    <div class="pergami-deco">‚ùß</div>
    <div class="instruccio-dita">Com acaba aquesta dita?</div>
    <div class="inici-dita" id="inici-dita">‚Ä¶</div>
  </div>
  <div class="opcions-grid" id="opcions-grid"></div>
  <div class="feedback-card" id="feedback-card">
    <div class="fb-ico" id="fb-ico"></div>
    <div class="fb-titol" id="fb-titol"></div>
    <div class="fb-refrany" id="fb-refrany"></div>
    <div class="fb-desc" id="fb-desc"></div>
    <button id="btn-seg" onclick="novaRonda()">Seg√ºent dita ‚ûî</button>
  </div>
  <div style="text-align:center;margin-top:8px;">
    <button onclick="tornar()" style="font-family:'Montserrat',sans-serif;font-size:.78rem;font-weight:700;color:var(--ink3);background:none;border:none;cursor:pointer;text-decoration:underline;padding:8px;">‚Ü© Men√∫ principal</button>
  </div>
</div>

</main>

<!-- MODAL AJUDA -->
<div id="modal-ajuda" class="modal-overlay">
  <div class="modal-box">
    <h2>üìú Com es juga?</h2>
    <div class="ajuda-pas"><span class="ajuda-ico">üìú</span><span>Apareix el principi d'una dita popular catalana. Has de triar com acaba entre 4 opcions.</span></div>
    <div class="ajuda-pas"><span class="ajuda-ico">‚ö†Ô∏è</span><span>Dues opcions son finals d'<strong>altres dites reals</strong>. Una √©s una <strong>continuaci√≥ de broma inventada</strong>. Vigila!</span></div>
    <div class="ajuda-pas"><span class="ajuda-ico">üî•</span><span>Encadena respostes correctes per fer ratxa. Si t'equivoques, la ratxa s'acaba.</span></div>
    <div class="ajuda-niv">
      <strong>üåø Nivell 1</strong> ‚Äî Dites populars i molt conegudes<br>
      <strong>ü¶â Nivell 2</strong> ‚Äî Dites que cal pensar-s'hi<br>
      <strong>üßì Nivell 3</strong> ‚Äî Les mes antigues i picants
    </div>
    <button id="btn-tancar-ajuda" onclick="tancarAjuda()">Entesos, a jugar!</button>
  </div>
</div>

<footer>
  <a href="https://ja.cat/gobo26" target="_blank" style="color:var(--ink3);text-decoration:none;font-weight:700;">Una aplicaci√≥ de Gobo26</a>
</footer>

<script>
var app = {
  niv: 1,
  ratxa: 0,
  usats: {1:[],2:[],3:[]},
};

var DITES = {
1:[
  {i:"Qui no vulgui pols,",c:"que no vagi a l'era",d:["que no escombri el terra","que tanqui la finestra"],b:"que porti les sabates molt ben tapades"},
  {i:"De mica en mica,",c:"s'omple la pica",d:["es fa la rica","s'apr√®n la m√∫sica"],b:"la mosca es fa gran i molt exigent"},
  {i:"Val m√©s un pardal a la m√†,",c:"que una perdiu en l'aire",d:["que deu al campanar","que anar al mercat"],b:"que un gall que et miri malament des del galliner"},
  {i:"Qui sembra vents,",c:"recull tempestes",d:["menja pols tot l'any","plora cada vespre"],b:"ha de comprar molts paraigua i for√ßa grans"},
  {i:"A la taula i al llit,",c:"al primer crit",d:["s'hi va vestit","no hi fa mai fred"],b:"s'hi va quan es vol i s'hi queda fins que es pot"},
  {i:"Qui no t√© feina,",c:"el gat pentina",d:["la son l'endormina","menja poca farina"],b:"fa llistes de coses que de tota manera mai far√†"},
  {i:"L'h√†bit,",c:"no fa el monjo",d:["fa l'home","no fa la por"],b:"fa les fotos de casament molt m√©s serioses"},
  {i:"Gos que lladra,",c:"no mossega",d:["mai no para","tothom el coneix"],b:"t√© un contracte amb l'ajuntament del poble"},
  {i:"Qui matina,",c:"fa farina",d:["truca a la campana","es tarda la canya"],b:"es troba el forn ja tancat i la cua llarga"},
  {i:"Feina feta,",c:"no fa nosa",d:["no es ref√†","ben pagada √©s una gosa"],b:"√©s la que ja no has de fer tu mai mes"},
  {i:"Quan el gat dorm,",c:"les rates ballen",d:["el ratol√≠ s'escapa","la casa s'engrandeix"],b:"el gat somia que √©s ell qui balla millor"},
  {i:"No diguis blat,",c:"fins que no sigui al sac i ben lligat",d:["si no n'has sembrat","si no √©s barat"],b:"si no vols que el ve√≠ et demani la recepta"},
  {i:"Tal far√†s,",c:"tal trobar√†s",d:["tal com vas","tal dir√†s"],b:"tal pensaran els ve√Øns de tu tot i no dir res"},
  {i:"A cavall regalat,",c:"no li miris el dentat",d:["no li diguis nat","mira on vas montat"],b:"millor que haguessin regalat directament diners"},
  {i:"La llengua no t√© ossos,",c:"per√≤ en trenca de molt grossos",d:["per√≤ parla molt i sola","per√≤ fa molts gossos"],b:"per√≤ alguns dies actua com si en tingu√©s molts"},
  {i:"Quan es tanca una porta,",c:"s'obre una finestra",d:["en queda una de millor","el vent no para"],b:"algun ve√≠ ho ha vist tot i ja ho explica"},
  {i:"Qui t√© boca,",c:"s'equivoca",d:["menja i s'ofoca","no pot callar"],b:"ha de comprar pasta de dents s√≠ o s√≠ cada mes"},
  {i:"Qui cerca,",c:"troba",d:["s'embolica","no para mai"],b:"fa tard a dinar perqu√® ha estat cercant massa"},
  {i:"Mai plou,",c:"a gust de tothom",d:["quan el camp ho vol","sense n√∫vols primer"],b:"quan has posat la roba a assecar al balc√≥"},
  {i:"Qui no arrisca,",c:"no pisca",d:["no guanya res","no avan√ßa gens"],b:"t√© l'asseguran√ßa al dia per√≤ s'avorreix for√ßa"}
],
2:[
  {i:"A bon entenedor,",c:"breu parlador",d:["bon receptor","cap paraula millor"],b:"mig explicaci√≥ ja li basta i li sobra"},
  {i:"A cada bugada,",c:"es perd un llen√ßol",d:["s'acaba l'estol","hi entra un consol"],b:"l'aigua s'emporta coses que apreciaves molt"},
  {i:"A gota a gota,",c:"es fa gorg",d:["s'omple el pot","es crema el crost√≥"],b:"t'adones massa tard que s'ha omplert el soterrani"},
  {i:"Aigua passada,",c:"no mou mol√≠",d:["mai no torna aqu√≠","fa fred al cam√≠"],b:"√©s molt bona per als peixos que ja hi viuen tan b√©"},
  {i:"Al gat vell,",c:"no cal ensenyar-li la rata",d:["no li rasques l'espata","li agrada la manta"],b:"li pots dir que √©s jove per√≤ no se'l creu gens"},
  {i:"Al pot petit,",c:"hi ha la bona confitura",d:["hi caben les lectures","hi ha bones aventures"],b:"hi pots posar exactament el que hi cap i punt"},
  {i:"Digue'm amb qui vas,",c:"i et dir√© qui ets",d:["i sabr√© on anir√†s","i ja ho s√© tot"],b:"i et dir√© si recordo on √©s el restaurant que em dius"},
  {i:"Home previngut,",c:"mai no √©s ven√ßut",d:["mai no √©s perdut","val m√©s que el sabut"],b:"porta paraigua fins i tot al mes d'agost"},
  {i:"Qui calla,",c:"consent",d:["s'av√© ben b√©","no ment mai"],b:"probablement est√† mirant el m√≤bil i no escolta"},
  {i:"El temps perdut,",c:"mai m√©s no torna",d:["no √©s ben guanyat","no es compra ni es ven"],b:"√©s el que vas passar mirant el sostre sense cap motiu"},
  {i:"En la terra dels cecs,",c:"el borni √©s el rei",d:["hi ha poca llei","tot √©s gris i grei"],b:"les ulleres no es venen gaire b√© ni les lents"},
  {i:"Val m√©s boig conegut,",c:"que savi per con√®ixer",d:["que cordura per vendre","que esperar sense cr√©ixer"],b:"perqu√® ja saps per on li surt el dimoni cada vegada"},
  {i:"Qui troba bon padr√≠,",c:"ja ha recorregut mig cam√≠",d:["no necessita viol√≠","viu millor sense fi"],b:"pot anar cantant a la feina des del primer dia"},
  {i:"Mira de qu√® es vanta,",c:"i sabr√†s que li falta",d:["i sabr√†s qui √©s i on planta","i sabr√†s si √©s dels de la Santa"],b:"i decideix si t'interessa sentir-ho fins al final del tot"},
  {i:"Si no pots impedir el vent,",c:"fes-te un mol√≠",d:["posa't un mantell fi","porta el capell ben fi"],b:"posa't darrere d'alg√∫ m√©s alt que no mogui els bra√ßos"},
  {i:"De pressa i b√©,",c:"no pot ser",d:["nom√©s hi ha fe","el pa no es fa"],b:"els cuiners amb estrella dirien que s√≠ si cobren prou"},
  {i:"Diners fan,",c:"diners",d:["papers i lligams","soroll als butxacons"],b:"que tothom et truqui molt m√©s sovint de cop i volta"},
  {i:"El lladre,",c:"sempre t√© por de ser robat",d:["no pot dormir ben aixoplugat","fa nosa al costat"],b:"duu sempre les claus de casa ben guardades a la butxaca"},
  {i:"La mala herba,",c:"sempre creix",d:["no es doblega en res","mai no fa profits"],b:"t√© una estrat√®gia de creixement molt s√≤lida i efica√ß"},
  {i:"Mai no √©s tard,",c:"quan arriba",d:["quan el cor ho mana","si hi ha seny de part"],b:"excepte als sopars de casament que comencen a les dotze"}
],
3:[
  {i:"A cal ferrer,",c:"ganivet de fusta",d:["tothom hi treballa","sempre hi ha flames enceses"],b:"el ferrer √©s el que menys sap on ha posat el martell"},
  {i:"Al lloc de la guineu,",c:"qui se n'aixeca ja no hi seu",d:["ning√∫ no hi va sense lleu","hi fa fred tot l'any"],b:"no hi posaries mai el cul si hi haguessis estat tu"},
  {i:"Al mal costum,",c:"trenca-li la cama",d:["d√≥na-li l'ama","no li diguis mai brama"],b:"explica-li molt suaument que no es porta gens b√©"},
  {i:"Boca muda,",c:"mai no √©s batuda",d:["mai no √©s perduda","fa pena nua"],b:"fa dif√≠cil saber si la persona √©s simp√†tica o no"},
  {i:"Hostes vingueren,",c:"que de casa ens tragueren",d:["que de tot ens digueren","que tot ens endugueren"],b:"i van fer servir totes les tovalloles bones de la casa"},
  {i:"La llei de l'embut:",c:"ample per a mi, estret per a tu",d:["tot per al dalt res per al mut","rod√≥ per a un quadrat per a l'altre"],b:"√©s la que millor coneix el qui la fa servir molt sovint"},
  {i:"Qui dorm amb canalla,",c:"es lleva pixat",d:["perd la batalla","no trova la falla"],b:"necessita un bon matal√†s una muda i molta paci√®ncia"},
  {i:"Qui no demana,",c:"pateix de gana",d:["no guanya res de res","fa sempre la trampa"],b:"creu que tothom ja sap el que necessita sense dir res"},
  {i:"Qui √©s sabater,",c:"que faci sabates",d:["que cusi b√© els bates","que no faci pilates"],b:"sap perfectament per on li entra l'aigua al peu"},
  {i:"Qui vulgui mentir,",c:"gran mem√≤ria ha de tenir",d:["que s√†piga escapar i fugir","que mai no es vulgui rendir"],b:"hauria de prendre notes perqu√® √©s molt mes complicat"},
  {i:"Se'n treu m√©s llepant,",c:"que mossegant",d:["que bufant amb ganes","que cridant ben fort"],b:"per√≤ als restaurants no t'ho permeten mai de fer"},
  {i:"Un parell de mamelles,",c:"fan dels homes titelles",d:["fan bones novelles","valen m√©s que dues estelles"],b:"√©s un refrany que avui dia requeriria moltes matisacions"},
  {i:"Vestiu un bast√≥,",c:"i semblar√† un senyor",d:["i no ser√† millor","i trobareu un amo major"],b:"i el bast√≥ continuar√† sent un bast√≥ per√≤ molt ben vestit"},
  {i:"Al mal que no t√© remei,",c:"√©s millor posar-hi seny",d:["no li donis cap consell","no hi poseu mirall"],b:"el millor √©s queixar-se molt fins que es resol sol"},
  {i:"Apr√®n primer a callar,",c:"si vols saber parlar",d:["si vols poder escoltar","si no vols plorar"],b:"per√≤ si et costa molt comen√ßa per murmurar fluixet"},
  {i:"Cadasc√∫ sap a casa seva,",c:"on li plou",d:["on s'ennuega i s'enreda","on li fa el frou"],b:"on es posa les calcetes i on guarda les coses secretes"},
  {i:"Qui t√© el cul llogat,",c:"no seu quan vol",d:["no para de moure's del tot","sempre fa el que vol"],b:"ha de mirar molt b√© les condicions del contracte"},
  {i:"De l'arbre caigut,",c:"tothom en fa llenya",d:["ning√∫ no en pren llenya","tothom s'hi acosta a veure"],b:"el pag√®s agra√Øt li posa un obituari al diari local"},
  {i:"Cada peu,",c:"troba la seva sabata",d:["va al seu cam√≠","fa el seu caminoi"],b:"t√© l'ungla que li toca i no se'n pot queixar gaire"},
  {i:"D'on no n'hi ha,",c:"no en raja",d:["no s'en fa cap avantaja","no en traur√†s cap gana"],b:"√©s el principi fonamental de moltes dietes actuals"}
]
};

var MSGS_BROMA = [
  "üÉè Era la trampa de broma!",
  "üòÇ T'han enxampat amb la falsa!",
  "üé≠ Pura invenci√≥! Has picat!",
  "ü§£ Aquesta me l'he inventat jo!",
  "ü™§ Era una trampa i has caigut!",
  "üòú Et vaig vendre fum i te'l vas comprar!",
  "üé™ Cap avi ho hauria dit mai aix√≤!",
  "ü§° La joker! I has triat la pitjor!",
  "üß¢ T'he posat el barret ben posat!",
  "üòÜ Ni en el millor refranyer existeix!",
  "üêî Cap avi s'ho hauria cregut mai!",
  "üéØ La trampa cl√†ssica i has caigut de quatre grapes.",
  "ü¶Ü Inventada de dalt a baix del tot!",
  "üåÄ Fantasia pura! Has mossegat l'ham.",
  "üÉè Era broma i t'ha conven√ßut del tot!",
];

// ---- INIT ----
function iniciar(n) {
  app.niv = n;
  app.ratxa = 0;
  app.usats = {1:[],2:[],3:[]};
  document.getElementById('p-inici').style.display = 'none';
  document.getElementById('p-joc').style.display = 'block';
  var noms = ['','üåø Populars','ü¶â Per pensar','üßì Dels avis'];
  document.getElementById('badge-niv').textContent = noms[n];
  actualitzarBadge();
  novaRonda();
}

function tornar() {
  document.getElementById('p-joc').style.display = 'none';
  document.getElementById('p-inici').style.display = 'block';
}

function novaRonda() {
  document.getElementById('feedback-card').style.display = 'none';
  var pool = DITES[app.niv];
  if (app.usats[app.niv].length >= pool.length) app.usats[app.niv] = [];
  var disp = pool.filter(function(_,i){ return app.usats[app.niv].indexOf(i) < 0; });
  var idx = Math.floor(Math.random() * disp.length);
  var ref = disp[idx];
  app.usats[app.niv].push(pool.indexOf(ref));

  document.getElementById('inici-dita').innerHTML = ref.i + ' <span class="punts-susp"> ¬∑¬∑¬∑</span>';

  var opcions = barrejar([
    {txt: ref.c, tipus: 'correcte'},
    {txt: ref.d[0], tipus: 'distractor'},
    {txt: ref.d[1], tipus: 'distractor'},
    {txt: ref.b, tipus: 'broma'}
  ]);

  var grid = document.getElementById('opcions-grid');
  grid.innerHTML = '';
  opcions.forEach(function(op) {
    var btn = document.createElement('button');
    btn.className = 'btn-op';
    btn.textContent = op.txt;
    btn.addEventListener('mousedown', sonarClic);
    btn.onclick = function(){ processarResposta(btn, op, ref, opcions); };
    grid.appendChild(btn);
  });
}

function processarResposta(btn, op, ref, totes) {
  document.querySelectorAll('.btn-op').forEach(function(b){ b.disabled = true; });
  var esBroma = op.tipus === 'broma';
  var encert = op.tipus === 'correcte';

  if (encert) {
    btn.classList.add('encert');
    sonarWin(); llen√ßarConfeti(); vibrar([60,30,100]);
    app.ratxa++;
    document.getElementById('fb-ico').textContent = app.ratxa >= 5 ? 'üî•' : app.ratxa >= 3 ? '‚≠ê' : '‚úÖ';
    document.getElementById('fb-titol').textContent = app.ratxa >= 5 ? 'RATXA x'+app.ratxa+'! Ets dels avis!' : app.ratxa >= 3 ? 'Molt b√©! Ratxa de '+app.ratxa+'!' : '‚úÖ Correcte!';
    document.getElementById('fb-titol').style.color = 'var(--ok)';
    document.getElementById('fb-refrany').textContent = '"' + ref.i + ' ' + ref.c + '"';
    document.getElementById('fb-desc').textContent = app.ratxa >= 3 ? 'üî• Ratxa de '+app.ratxa+'! Continua aix√≠!' : 'Ben trobat!';
  } else {
    btn.classList.add('error');
    sonarErr(); vibrar([100,50,150]);
    var btns = Array.from(document.querySelectorAll('.btn-op'));
    btns.forEach(function(b, i) {
      if (totes[i] && totes[i].tipus === 'correcte') b.classList.add('revelat');
      if (totes[i] && totes[i].tipus === 'broma' && b !== btn) b.classList.add('broma-rev');
    });
    app.ratxa = 0;
    document.getElementById('fb-ico').textContent = esBroma ? 'üÉè' : '‚ùå';
    document.getElementById('fb-titol').textContent = esBroma ? MSGS_BROMA[Math.floor(Math.random()*MSGS_BROMA.length)] : '‚ùå No era aquesta!';
    document.getElementById('fb-titol').style.color = 'var(--err)';
    document.getElementById('fb-refrany').textContent = '"' + ref.i + ' ' + ref.c + '"';
    document.getElementById('fb-desc').textContent = esBroma ? 'La continuaci√≥ de broma t\'ha conven√ßut!' : 'Era el final d\'un altre refrany real.';
  }

  actualitzarBadge();
  document.getElementById('feedback-card').style.display = 'block';
  setTimeout(function(){ document.getElementById('btn-seg').focus(); }, 100);
}

function actualitzarBadge() {
  var br = document.getElementById('badge-ratxa');
  br.textContent = 'üéØ Ratxa: ' + app.ratxa;
  br.className = 'badge ' + (app.ratxa >= 5 ? 'gold' : app.ratxa > 0 ? 'bo' : '');
}

function mostrarAjuda(){ document.getElementById('modal-ajuda').classList.add('show'); }
function tancarAjuda(){ document.getElementById('modal-ajuda').classList.remove('show'); }

function barrejar(a) {
  var b = a.slice();
  for (var i = b.length-1; i > 0; i--) {
    var j = Math.floor(Math.random()*(i+1));
    var t = b[i]; b[i] = b[j]; b[j] = t;
  }
  return b;
}

// --- SONS ---
var actx;
function ga(){ if(!actx) actx = new(window.AudioContext||window.webkitAudioContext)(); return actx; }
function sonarClic(){try{var c=ga();if(c.state==='suspended')c.resume();var o=c.createOscillator(),g=c.createGain();o.connect(g);g.connect(c.destination);o.frequency.value=400;g.gain.setValueAtTime(.03,c.currentTime);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+.07);o.start();o.stop(c.currentTime+.07);}catch(e){}}
function sonarErr(){try{var c=ga();if(c.state==='suspended')c.resume();var o=c.createOscillator(),g=c.createGain();o.type='sawtooth';o.connect(g);g.connect(c.destination);o.frequency.setValueAtTime(160,c.currentTime);o.frequency.linearRampToValueAtTime(80,c.currentTime+.22);g.gain.setValueAtTime(.07,c.currentTime);g.gain.linearRampToValueAtTime(0,c.currentTime+.22);o.start();o.stop(c.currentTime+.22);}catch(e){}}
function sonarWin(){try{var c=ga();if(c.state==='suspended')c.resume();[[440,.1],[554,.1],[659,.1],[880,.32]].forEach(function(fd,i){var o=c.createOscillator(),g=c.createGain();o.type='triangle';o.connect(g);g.connect(c.destination);o.frequency.value=fd[0];var t=c.currentTime+i*.13;g.gain.setValueAtTime(.07,t);g.gain.exponentialRampToValueAtTime(.001,t+fd[1]);o.start(t);o.stop(t+fd[1]);});}catch(e){}}

// --- CONFETI ---
function llen√ßarConfeti(){
  var cs=['#b45309','#d97706','#16a34a','#2563eb','#9333ea','#dc2626'];
  for(var i=0;i<55;i++){
    (function(i){
      setTimeout(function(){
        var e=document.createElement('div');
        e.className='confeti';
        e.style.left=Math.random()*100+'vw';
        e.style.top='-10px';
        e.style.background=cs[Math.floor(Math.random()*cs.length)];
        e.style.animationDuration=(1.4+Math.random()*1.8)+'s';
        var s=(4+Math.random()*6)+'px';
        e.style.width=s; e.style.height=s;
        e.style.borderRadius=Math.random()>.5?'50%':'0';
        document.body.appendChild(e);
        setTimeout(function(){e.remove();},3500);
      },i*28);
    })(i);
  }
}
function vibrar(p){ if(navigator.vibrate) navigator.vibrate(p); }
</script>
</body>
</html>
